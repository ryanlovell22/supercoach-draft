<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SuperCoach Draft Assistant 2026</title>
<script src="players_data.js?v=20260226"></script>
<style>
:root {
  --bg: #0f0f1a;
  --bg2: #1a1a2e;
  --bg3: #25253d;
  --text: #e0e0e0;
  --text2: #999;
  --def: #4a9eff;
  --mid: #4aff9e;
  --ruc: #ffaa4a;
  --fwd: #ff4a6a;
  --dual: #c77dff;
  --accent: #6c63ff;
  --green: #22c55e;
  --red: #ef4444;
  --yellow: #eab308;
  --border: #333355;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
button { cursor: pointer; font-family: inherit; }
input, select { font-family: inherit; }

/* Config Screen */
#config-screen { max-width: 600px; margin: 0 auto; padding: 20px; }
#config-screen h1 { text-align: center; font-size: 1.6rem; margin-bottom: 8px; }
#config-screen .subtitle { text-align: center; color: var(--text2); margin-bottom: 30px; font-size: 0.9rem; }
.config-group { background: var(--bg2); border-radius: 12px; padding: 16px; margin-bottom: 16px; border: 1px solid var(--border); }
.config-group h3 { font-size: 0.85rem; text-transform: uppercase; color: var(--text2); letter-spacing: 1px; margin-bottom: 12px; }
.config-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.config-row label { font-size: 0.95rem; }
.config-row input, .config-row select { background: var(--bg3); border: 1px solid var(--border); color: var(--text); padding: 8px 12px; border-radius: 8px; font-size: 1rem; width: 80px; text-align: center; }
.config-row select { width: auto; text-align: left; }
.roster-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.roster-item { display: flex; align-items: center; justify-content: space-between; background: var(--bg); border-radius: 8px; padding: 8px 12px; }
.roster-item .pos-badge { font-weight: 700; font-size: 0.85rem; width: 36px; }
.roster-item input { width: 50px; }
.pos-def { color: var(--def); }
.pos-mid { color: var(--mid); }
.pos-ruc { color: var(--ruc); }
.pos-fwd { color: var(--fwd); }
#start-btn { display: block; width: 100%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; margin-top: 20px; transition: opacity 0.2s; }
#start-btn:hover { opacity: 0.9; }

/* Draft Screen */
#draft-screen { display: none; max-width: 900px; margin: 0 auto; padding: 8px; }
.pick-bar { background: var(--bg2); border-radius: 12px; padding: 12px 16px; margin-bottom: 8px; border: 1px solid var(--border); }
.pick-bar .pick-info { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; }
.pick-bar .pick-num { font-size: 1.3rem; font-weight: 700; }
.pick-bar .pick-num.my-turn { color: var(--green); }
.pick-bar .next-pick { color: var(--text2); font-size: 0.85rem; }
.pick-bar .pick-dots { display: flex; gap: 3px; margin-top: 8px; flex-wrap: wrap; }
.pick-dot { width: 14px; height: 14px; border-radius: 50%; background: var(--bg3); border: 1px solid var(--border); font-size: 0; flex-shrink: 0; }
.pick-dot.done { background: var(--text2); border-color: var(--text2); }
.pick-dot.current { background: var(--accent); border-color: var(--accent); box-shadow: 0 0 6px var(--accent); }
.pick-dot.mine { border-color: var(--green); border-width: 2px; }
.pick-dot.mine.done { background: var(--green); }

/* Alerts */
.alerts { display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px; }
.alert { padding: 8px 12px; border-radius: 8px; font-size: 0.85rem; font-weight: 600; }
.alert-cliff { background: rgba(234, 179, 8, 0.15); color: var(--yellow); border: 1px solid rgba(234, 179, 8, 0.3); }
.alert-run { background: rgba(108, 99, 255, 0.15); color: #a09cff; border: 1px solid rgba(108, 99, 255, 0.3); }
.alert-need { background: rgba(239, 68, 68, 0.15); color: var(--red); border: 1px solid rgba(239, 68, 68, 0.3); }
.alert-myturn { background: rgba(34, 197, 94, 0.15); color: var(--green); border: 1px solid rgba(34, 197, 94, 0.3); font-size: 1rem; text-align: center; }

/* Tabs */
.tabs { display: flex; gap: 4px; margin-bottom: 8px; background: var(--bg2); border-radius: 10px; padding: 4px; }
.tab { flex: 1; padding: 10px 8px; border: none; background: transparent; color: var(--text2); font-size: 0.85rem; font-weight: 600; border-radius: 8px; transition: all 0.2s; }
.tab.active { background: var(--accent); color: white; }
.tab .badge { display: inline-block; background: var(--red); color: white; font-size: 0.7rem; border-radius: 10px; padding: 1px 6px; margin-left: 4px; vertical-align: middle; }

/* Recommendations */
.recs { display: flex; flex-direction: column; gap: 6px; }
.rec-card { background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 12px; transition: border-color 0.2s; }
.rec-card:first-child { border-color: var(--green); }
.rec-rank { font-size: 1.4rem; font-weight: 800; color: var(--text2); width: 30px; text-align: center; flex-shrink: 0; }
.rec-card:first-child .rec-rank { color: var(--green); }
.rec-info { flex: 1; min-width: 0; }
.rec-name { font-weight: 700; font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rec-meta { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 4px; font-size: 0.8rem; color: var(--text2); }
.rec-badges { display: flex; gap: 4px; margin-top: 4px; flex-wrap: wrap; }
.badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
.badge-tier { background: rgba(234, 179, 8, 0.2); color: var(--yellow); }
.badge-tier-1 { background: rgba(234, 179, 8, 0.25); color: #fbbf24; }
.badge-tier-2 { background: rgba(108, 99, 255, 0.2); color: #a09cff; }
.badge-tier-3 { background: rgba(34, 197, 94, 0.2); color: var(--green); }
.badge-dual { background: rgba(199, 125, 255, 0.2); color: var(--dual); }
.badge-consistent { background: rgba(34, 197, 94, 0.15); color: var(--green); }
.badge-durable { background: rgba(74, 158, 255, 0.15); color: var(--def); }
.badge-scarce { background: rgba(239, 68, 68, 0.2); color: var(--red); }
.rec-avg { font-size: 1.1rem; font-weight: 700; flex-shrink: 0; }
.rec-vorp { font-size: 0.75rem; color: var(--green); font-weight: 600; }
.pos-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; }
.pos-tag-DEF { background: rgba(74, 158, 255, 0.2); color: var(--def); }
.pos-tag-MID { background: rgba(74, 255, 158, 0.2); color: var(--mid); }
.pos-tag-RUC { background: rgba(255, 170, 74, 0.2); color: var(--ruc); }
.pos-tag-FWD { background: rgba(255, 74, 106, 0.2); color: var(--fwd); }
.rec-draft-btn { background: var(--green); color: #000; border: none; padding: 8px 14px; border-radius: 8px; font-weight: 700; font-size: 0.85rem; flex-shrink: 0; transition: opacity 0.2s; }
.rec-draft-btn:hover { opacity: 0.85; }
.rec-draft-btn.other { background: var(--bg3); color: var(--text); border: 1px solid var(--border); }
.rec-draft-btn.other:hover { border-color: var(--red); color: var(--red); }
.rec-remove-btn { background: transparent; color: var(--text2); border: 1px solid var(--border); padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; cursor: pointer; opacity: 0.5; transition: all 0.2s; }
.rec-remove-btn:hover { opacity: 1; border-color: var(--red); color: var(--red); background: rgba(255,69,58,0.1); }
.pl-remove-btn { background: transparent; color: var(--text2); border: none; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; cursor: pointer; opacity: 0.4; transition: all 0.2s; flex-shrink: 0; width: 24px; text-align: center; }
.pl-remove-btn:hover { opacity: 1; color: var(--red); background: rgba(255,69,58,0.15); }
#removed-bar { display: none; align-items: center; gap: 8px; padding: 6px 12px; background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; font-size: 0.8rem; color: var(--text2); }
#removed-bar button { background: var(--bg3); color: var(--text); border: 1px solid var(--border); padding: 3px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; }
#removed-bar button:hover { border-color: var(--accent); color: var(--accent); }

/* Players Tab */
.search-bar { display: flex; gap: 8px; margin-bottom: 8px; }
.search-bar input { flex: 1; background: var(--bg2); border: 1px solid var(--border); color: var(--text); padding: 10px 14px; border-radius: 10px; font-size: 1rem; outline: none; }
.search-bar input:focus { border-color: var(--accent); }
.pos-filters { display: flex; gap: 4px; margin-bottom: 8px; flex-wrap: wrap; }
.pos-filter { padding: 6px 12px; border: 1px solid var(--border); background: var(--bg2); color: var(--text2); border-radius: 8px; font-size: 0.8rem; font-weight: 600; }
.pos-filter.active { border-color: var(--accent); color: white; background: var(--bg3); }
.player-list { max-height: 60vh; overflow-y: auto; }
.player-row { display: flex; align-items: center; padding: 8px 12px; border-bottom: 1px solid var(--border); gap: 8px; cursor: pointer; transition: background 0.15s; }
.player-row:hover { background: var(--bg3); }
.player-row.drafted { opacity: 0.35; text-decoration: line-through; pointer-events: none; }
.player-row .pl-name { flex: 1; font-weight: 600; font-size: 0.9rem; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.player-row .pl-team { color: var(--text2); font-size: 0.8rem; width: 40px; flex-shrink: 0; }
.player-row .pl-avg { font-weight: 700; width: 45px; text-align: right; flex-shrink: 0; }

/* My Team Tab */
.my-team { display: flex; flex-direction: column; gap: 12px; }
.team-pos-group { background: var(--bg2); border-radius: 10px; padding: 12px; border: 1px solid var(--border); }
.team-pos-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.team-pos-title { font-weight: 700; font-size: 0.95rem; }
.team-pos-count { font-size: 0.8rem; color: var(--text2); }
.team-pos-count .filled { color: var(--green); }
.team-player { display: flex; justify-content: space-between; padding: 4px 0; font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
.team-player:last-child { border-bottom: none; }
.team-player .tp-avg { font-weight: 600; }
.team-empty { color: var(--text2); font-size: 0.85rem; font-style: italic; padding: 4px 0; }

/* Draft Log Tab */
.draft-log { max-height: 60vh; overflow-y: auto; }
.log-entry { display: flex; align-items: center; padding: 6px 10px; border-bottom: 1px solid var(--border); gap: 8px; font-size: 0.85rem; }
.log-entry.my-pick { background: rgba(34, 197, 94, 0.08); }
.log-pick { font-weight: 700; color: var(--text2); width: 35px; flex-shrink: 0; }
.log-name { flex: 1; font-weight: 600; }

/* Undo */
.undo-btn { position: fixed; bottom: 20px; right: 20px; background: var(--bg3); color: var(--text); border: 1px solid var(--border); padding: 10px 16px; border-radius: 10px; font-size: 0.85rem; font-weight: 600; z-index: 10; box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
.undo-btn:hover { border-color: var(--accent); }
.skip-btn { position: fixed; bottom: 20px; right: 110px; background: var(--bg3); color: var(--text2); border: 1px solid var(--border); padding: 10px 16px; border-radius: 10px; font-size: 0.85rem; font-weight: 600; z-index: 10; box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
.skip-btn:hover { border-color: var(--yellow); color: var(--yellow); }

/* Confirmation modal */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; align-items: center; justify-content: center; }
.modal-overlay.show { display: flex; }
.modal { background: var(--bg2); border-radius: 14px; padding: 24px; max-width: 360px; width: 90%; text-align: center; border: 1px solid var(--border); }
.modal h3 { margin-bottom: 8px; font-size: 1.1rem; }
.modal p { color: var(--text2); margin-bottom: 16px; font-size: 0.9rem; }
.modal-btns { display: flex; gap: 8px; }
.modal-btns button { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: 700; font-size: 0.95rem; }
.modal-cancel { background: var(--bg3); color: var(--text); }
.modal-confirm { background: var(--green); color: #000; }
.modal-confirm.draft-other { background: var(--red); color: white; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--bg3); border-radius: 3px; }

/* Responsive */
@media (max-width: 480px) {
  .rec-card { padding: 10px; gap: 8px; }
  .pick-bar .pick-num { font-size: 1.1rem; }
  .rec-draft-btn { padding: 6px 10px; }
}

/* Risk badges */
.badge-out { background: rgba(239, 68, 68, 0.25); color: #ff6b6b; }
.badge-injured { background: rgba(255, 170, 74, 0.2); color: var(--ruc); }
.badge-minor { background: rgba(234, 179, 8, 0.2); color: var(--yellow); }
.badge-trade { background: rgba(74, 158, 255, 0.2); color: var(--def); }
.badge-dpp-change { background: rgba(153, 153, 153, 0.2); color: #bbb; }
.badge-late-mode { background: rgba(108, 99, 255, 0.15); color: #a09cff; border: 1px solid rgba(108, 99, 255, 0.3); padding: 6px 12px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; margin-bottom: 8px; text-align: center; }
.badge-fragile { background: rgba(239, 68, 68, 0.25); color: #ff6b6b; }
.badge-volatile { background: rgba(255, 170, 74, 0.15); color: var(--ruc); }
.badge-blended { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
.badge-inj-season { background: rgba(239, 68, 68, 0.3); color: #ff6b6b; }
.badge-inj-months { background: rgba(255, 120, 50, 0.25); color: #ff8c42; }
.badge-inj-weeks { background: rgba(255, 170, 74, 0.25); color: #ffaa4a; }
.badge-inj-doubt { background: rgba(234, 179, 8, 0.2); color: #eab308; }
.badge-inj-managed { background: rgba(74, 158, 255, 0.12); color: #6ea8d7; }
.inj-detail { font-size: 0.7rem; color: #ff8c42; margin-top: 2px; }
.rec-trend { font-size: 0.7rem; color: var(--text2); display: inline-flex; gap: 1px; align-items: center; white-space: nowrap; }
.rec-games { font-size: 0.65rem; color: var(--text2); opacity: 0.7; white-space: nowrap; }
.rec-age { font-size: 0.7rem; color: var(--text2); opacity: 0.7; }
.pl-games { font-size: 0.7rem; color: var(--text2); width: 80px; text-align: right; flex-shrink: 0; white-space: nowrap; }
.pl-age { font-size: 0.8rem; color: var(--text2); width: 30px; text-align: right; flex-shrink: 0; }
.trend-up { color: var(--green); }
.trend-down { color: var(--red); }
.trend-stable { color: var(--text2); }
.fragile-swap { font-size: 0.7rem; color: #ff6b6b; margin-top: 2px; }
.rec-ev { font-size: 0.75rem; color: var(--accent); font-weight: 600; }
.hugo-risk-vlow { background: rgba(34, 197, 94, 0.2); color: var(--green); }
.hugo-risk-low { background: rgba(74, 158, 255, 0.15); color: var(--def); }
.hugo-risk-med { background: rgba(234, 179, 8, 0.2); color: var(--yellow); }
.hugo-risk-high { background: rgba(239, 68, 68, 0.2); color: var(--red); }
.hugo-range { font-size: 0.7rem; color: var(--text2); font-weight: 600; }
.hugo-range.steal { color: var(--green); }
.hugo-range.reach { color: var(--red); }
.hugo-note { font-size: 0.7rem; color: var(--text2); margin-top: 2px; font-style: italic; }
.hugo-note .concern { color: var(--red); font-style: normal; }
.hugo-note .opportunity { color: var(--green); font-style: normal; }

/* League Charts */
.chart-container { display: flex; flex-direction: column; gap: 12px; }
.chart-section { background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 12px; }
.chart-title { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text2); margin-bottom: 8px; }
.chart-section canvas { width: 100%; display: block; }
</style>
</head>
<body>

<!-- CONFIG SCREEN -->
<div id="config-screen">
  <h1>SuperCoach Draft Assistant</h1>
  <p class="subtitle">AFL 2026 — EV Scoring: Best Available × Availability (Volatile Blend)</p>

  <div class="config-group">
    <h3>Draft Settings</h3>
    <div class="config-row">
      <label>Number of Teams</label>
      <input type="number" id="cfg-teams" value="18" min="2" max="30">
    </div>
    <div class="config-row">
      <label>Your Draft Position</label>
      <input type="number" id="cfg-pos" value="10" min="1" max="30">
    </div>
    <div class="config-row">
      <label>Total Rounds</label>
      <input type="number" id="cfg-rounds" value="16" min="5" max="40">
    </div>
  </div>

  <div class="config-group">
    <h3>On-Field Roster</h3>
    <div class="roster-grid">
      <div class="roster-item">
        <span class="pos-badge pos-def">DEF</span>
        <input type="number" id="cfg-def" value="4" min="0" max="10">
      </div>
      <div class="roster-item">
        <span class="pos-badge pos-mid">MID</span>
        <input type="number" id="cfg-mid" value="4" min="0" max="12">
      </div>
      <div class="roster-item">
        <span class="pos-badge pos-ruc">RUC</span>
        <input type="number" id="cfg-ruc" value="1" min="0" max="4">
      </div>
      <div class="roster-item">
        <span class="pos-badge pos-fwd">FWD</span>
        <input type="number" id="cfg-fwd" value="4" min="0" max="10">
      </div>
    </div>
  </div>

  <div class="config-group">
    <h3>Bench (any position)</h3>
    <div class="roster-grid">
      <div class="roster-item">
        <span class="pos-badge" style="background:var(--bg3);color:var(--text);">BENCH</span>
        <input type="number" id="cfg-bench" value="3" min="0" max="8">
      </div>
    </div>
  </div>

  <button id="start-btn" onclick="startDraft()">Start Draft</button>
</div>

<!-- DRAFT SCREEN -->
<div id="draft-screen">
  <div class="pick-bar">
    <div class="pick-info">
      <div class="pick-num" id="pick-label">Pick #1</div>
      <div class="next-pick" id="next-pick-label"></div>
    </div>
    <div class="pick-dots" id="pick-dots"></div>
  </div>

  <div class="alerts" id="alerts"></div>

  <div class="tabs">
    <button class="tab active" data-tab="recs" onclick="switchTab('recs')">Picks</button>
    <button class="tab" data-tab="players" onclick="switchTab('players')">Players</button>
    <button class="tab" data-tab="team" onclick="switchTab('team')">My Team <span class="badge" id="team-count">0</span></button>
    <button class="tab" data-tab="log" onclick="switchTab('log')">Log</button>
    <button class="tab" data-tab="league" onclick="switchTab('league')">League</button>
  </div>

  <div id="tab-recs" class="tab-content">
    <div id="removed-bar"></div>
    <div class="recs" id="recs-list"></div>
  </div>

  <div id="tab-players" class="tab-content" style="display:none">
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Search player name..." oninput="renderPlayers()">
    </div>
    <div class="pos-filters" id="pos-filters"></div>
    <div class="player-header" style="display:flex; gap:8px; align-items:center; padding:4px 8px; font-size:0.65rem; color:var(--text2); opacity:0.6; border-bottom:1px solid var(--border);">
      <span style="width:80px;">Pos</span>
      <span style="flex:1;">Name</span>
      <span style="width:40px;">Team</span>
      <span style="width:30px; text-align:right;">Age</span>
      <span style="width:80px; text-align:right;">Games</span>
      <span style="width:45px; text-align:right;">Avg</span>
      <span style="width:24px;"></span>
    </div>
    <div class="player-list" id="player-list"></div>
  </div>

  <div id="tab-team" class="tab-content" style="display:none">
    <div class="my-team" id="my-team"></div>
  </div>

  <div id="tab-log" class="tab-content" style="display:none">
    <div class="draft-log" id="draft-log"></div>
  </div>

  <div id="tab-league" class="tab-content" style="display:none">
    <div class="chart-container">
      <div class="chart-section">
        <h3 class="chart-title">League EV Projection</h3>
        <canvas id="ev-chart"></canvas>
      </div>
      <div class="chart-section">
        <h3 class="chart-title">Positional Supply</h3>
        <canvas id="supply-chart"></canvas>
      </div>
    </div>
  </div>

  <button class="skip-btn" onclick="skipPick()">Skip Pick</button>
  <button class="undo-btn" onclick="undoPick()">&#8630; Undo</button>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h3 id="modal-title">Draft Player?</h3>
    <p id="modal-text"></p>
    <div class="modal-btns">
      <button class="modal-cancel" onclick="closeModal()">Cancel</button>
      <button class="modal-confirm" id="modal-confirm" onclick="confirmModal()">Draft</button>
    </div>
  </div>
</div>

<script>
/* =========================================================
   STATE & CONFIG
   ========================================================= */
let state = {
  phase: 'config',
  config: {},
  currentPick: 1,       // 1-indexed overall pick number
  picks: [],            // { player, pickNum, isMyPick, pickPos }
  myTeam: { DEF: [], MID: [], RUC: [], FWD: [] },
  myBench: [],  // flexible bench — any position
  draftedNames: new Set(),
  removedNames: new Set(),
  tiers: {},            // { DEF: { playerName: tierNum }, ... }
  replacementLevels: {},
  activeTab: 'recs',
  posFilter: 'ALL',
  modalCallback: null,
};

/* =========================================================
   PLAYER EXTRA DATA — Games played (2024, 2023) + Age
   Source: AFL Tables (afltables.com)
   ========================================================= */
const PLAYER_EXTRA = {
  "Marcus Bontempelli": { g24: 24, g23: 23, age: 30 },
  "Max Gawn": { g24: 21, g23: 22, age: 34 },
  "Tristan Xerri": { g24: 23, g23: 9, age: 26 },
  "Brodie Grundy": { g24: 26, g23: 17, age: 31 },
  "Zak Butters": { g24: 26, g23: 25, age: 25 },
  "Matt Rowell": { g24: 23, g23: 23, age: 24 },
  "Hugh McCluggage": { g24: 27, g23: 25, age: 27 },
  "Nick Daicos": { g24: 23, g23: 22, age: 23 },
  "Bailey Smith": { g24: 15, g23: 19, age: 25 },
  "Lachie Whitfield": { g24: 25, g23: 24, age: 31 },
  "Nasiah Wanganeen-Milera": { g24: 22, g23: 24, age: 23 },
  "Andrew Brayshaw": { g24: 23, g23: 23, age: 26 },
  "Luke Jackson": { g24: 23, g23: 23, age: 24 },
  "Noah Anderson": { g24: 23, g23: 23, age: 25 },
  "Josh Dunkley": { g24: 27, g23: 24, age: 29 },
  "Max Holmes": { g24: 25, g23: 21, age: 23 },
  "George Hewett": { g24: 22, g23: 22, age: 30 },
  "Jack Sinclair": { g24: 22, g23: 24, age: 31 },
  "Finn Callaghan": { g24: 24, g23: 21, age: 22 },
  "Ed Richards": { g24: 21, g23: 19, age: 26 },
  "Tim English": { g24: 23, g23: 23, age: 28 },
  "Tom Liberatore": { g24: 18, g23: 21, age: 33 },
  "Tom Green": { g24: 25, g23: 22, age: 25 },
  "Touk Miller": { g24: 18, g23: 13, age: 30 },
  "Jordan Dawson": { g24: 22, g23: 23, age: 28 },
  "Darcy Cameron": { g24: 23, g23: 19, age: 30 },
  "Isaac Heeney": { g24: 24, g23: 23, age: 29 },
  "Lachie Ash": { g24: 19, g23: 26, age: 24 },
  "Zach Merrett": { g24: 23, g23: 22, age: 30 },
  "Caleb Serong": { g24: 23, g23: 22, age: 25 },
  "Harry Sheezel": { g24: 21, g23: 23, age: 21 },
  "Rowan Marshall": { g24: 23, g23: 24, age: 30 },
  "Rory Laird": { g24: 23, g23: 22, age: 32 },
  "Lachie Neale": { g24: 26, g23: 26, age: 32 },
  "Connor Rozee": { g24: 23, g23: 25, age: 26 },
  "Errol Gulden": { g24: 26, g23: 24, age: 23 },
  "Dayne Zorko": { g24: 27, g23: 20, age: 37 },
  "Jordan Clark": { g24: 23, g23: 23, age: 25 },
  "Jarrod Witts": { g24: 16, g23: 21, age: 33 },
  "Nic Martin": { g24: 23, g23: 23, age: 24 },
  "Will Ashcroft": { g24: 13, g23: 18, age: 21 },
  "Jack Macrae": { g24: 19, g23: 22, age: 31 },
  "Bailey Dale": { g24: 24, g23: 23, age: 29 },
  "Lloyd Meek": { g24: 21, g23: 16, age: 27 },
  "Nick Blakey": { g24: 26, g23: 24, age: 26 },
  "Luke Davies-Uniacke": { g24: 23, g23: 14, age: 26 },
  "Jye Caldwell": { g24: 23, g23: 21, age: 25 },
  "Sam Darcy": { g24: 21, g23: 3, age: 22 },
  "Sam Walsh": { g24: 20, g23: 18, age: 25 },
  "Scott Pendlebury": { g24: 20, g23: 25, age: 38 },
  "Izak Rankine": { g24: 15, g23: 20, age: 25 },
  "Jason Horne-Francis": { g24: 24, g23: 24, age: 22 },
  "Callum Mills": { g24: 7, g23: 20, age: 28 },
  "Will Day": { g24: 16, g23: 21, age: 24 },
  "Tom Stewart": { g24: 23, g23: 22, age: 32 },
  "Tom Atkins": { g24: 22, g23: 23, age: 30 },
  "Tim Taranto": { g24: 15, g23: 23, age: 28 },
  "Jai Newcombe": { g24: 25, g23: 22, age: 24 },
  "Adam Cerra": { g24: 13, g23: 22, age: 26 },
  "Toby Nankervis": { g24: 21, g23: 15, age: 31 },
  "Riley Thilthorpe": { g24: 7, g23: 21, age: 23 },
  "Patrick Cripps": { g24: 24, g23: 24, age: 30 },
  "Hayden Young": { g24: 23, g23: 22, age: 24 },
  "Jack Steele": { g24: 23, g23: 21, age: 30 },
  "Tom De Koning": { g24: 18, g23: 19, age: 26 },
  "Jordan Ridley": { g24: 9, g23: 17, age: 27 },
  "Josh Daicos": { g24: 23, g23: 26, age: 27 },
  "Christian Petracca": { g24: 13, g23: 25, age: 30 },
  "John Noble": { g24: 20, g23: 23, age: 28 },
  "Matthew Kennedy": { g24: 24, g23: 16, age: 28 },
  "Mason Redman": { g24: 21, g23: 23, age: 28 },
  "Ollie Wines": { g24: 25, g23: 25, age: 31 },
  "Gryan Miers": { g24: 25, g23: 23, age: 26 },
  "Steele Sidebottom": { g24: 22, g23: 20, age: 35 },
  "Karl Amon": { g24: 25, g23: 21, age: 30 },
  "Reilly O'Brien": { g24: 21, g23: 23, age: 30 },
  "Luke Ryan": { g24: 23, g23: 23, age: 30 },
  "Caleb Daniel": { g24: 16, g23: 23, age: 29 },
  "Nick Vlastuin": { g24: 22, g23: 21, age: 31 },
  "Chad Warner": { g24: 25, g23: 21, age: 24 },
  "Tom McCarthy": { g24: null, g23: null, age: null },
  "Harry McKay": { g24: 21, g23: 21, age: 28 },
  "Callum Wilkie": { g24: 23, g23: 24, age: 29 },
  "Clayton Oliver": { g24: 21, g23: 15, age: 28 },
  "Jake Bowey": { g24: 14, g23: 23, age: 23 },
  "Liam Baker": { g24: 18, g23: 23, age: 28 },
  "Josh Worrell": { g24: 13, g23: 12, age: 24 },
  "Sam Draper": { g24: 16, g23: 14, age: 27 },
  "Kysaiah Pickett": { g24: 21, g23: 23, age: 24 },
  "Christian Salem": { g24: 17, g23: 16, age: 30 },
  "Brayden Fiorini": { g24: 12, g23: 17, age: 28 },
  "Jack Crisp": { g24: 23, g23: 26, age: 32 },
  "Sam Durham": { g24: 22, g23: 22, age: 24 },
  "Will Setterfield": { g24: 4, g23: 10, age: 28 },
  "Matt Roberts": { g24: 23, g23: 6, age: 22 },
  "Jacob Hopper": { g24: 12, g23: 16, age: 29 },
  "George Stevens": { g24: null, g23: null, age: null },
  "Jarrod Berry": { g24: 27, g23: 25, age: 28 },
  "Zac Bailey": { g24: 22, g23: 24, age: 26 },
  "Jeremy Cameron": { g24: 24, g23: 20, age: 32 },
  "Jake Soligo": { g24: 23, g23: 21, age: 23 },
  "James Sicily": { g24: 22, g23: 19, age: 31 },
  "Darcy Parish": { g24: 12, g23: 18, age: 28 },
  "Josh Kelly": { g24: 17, g23: 22, age: 31 },
  "Jack Gunston": { g24: 18, g23: 17, age: 34 },
  "Justin McInerney": { g24: 20, g23: 19, age: 25 },
  "Luke Parker": { g24: 10, g23: 23, age: 33 },
  "Jack Graham": { g24: 14, g23: 20, age: 28 },
  "Kane Farrell": { g24: 22, g23: 22, age: 26 },
  "Jaspa Fletcher": { g24: 27, g23: 14, age: 22 },
  "James Tunstill": { g24: 4, g23: 2, age: 22 },
  "Ryan Maric": { g24: 19, g23: 10, age: 21 },
  "Harry Himmelberg": { g24: 25, g23: 25, age: 29 },
  "Dylan Moore": { g24: 25, g23: 23, age: 26 },
  "Marc Pittonet": { g24: 14, g23: 18, age: 29 },
  "Jordon Sweet": { g24: 17, g23: null, age: 28 },
  "Jack Viney": { g24: 23, g23: 24, age: 31 },
  "Jy Simpkin": { g24: 18, g23: 18, age: 27 },
  "Darcy Wilmot": { g24: 27, g23: 26, age: 22 },
  "Adam Treloar": { g24: 23, g23: 19, age: 32 },
  "Steven May": { g24: 19, g23: 23, age: 34 },
  "Nicholas Madden": { g24: null, g23: null, age: null },
  "Kieren Briggs": { g24: 24, g23: 17, age: 26 },
  "Joel Jeffrey": { g24: 12, g23: 7, age: 23 },
  "Patrick Dangerfield": { g24: 16, g23: 18, age: 35 },
  "Angus Sheldrick": { g24: null, g23: 7, age: 22 },
  "Connor Idun": { g24: 25, g23: 26, age: 25 },
  "Tom Powell": { g24: 23, g23: 14, age: 23 },
  "Jayden Short": { g24: 22, g23: 16, age: 30 },
  "Shaun Mannagh": { g24: 12, g23: null, age: 28 },
  "Andrew McGrath": { g24: 23, g23: 23, age: 27 },
  "Miles Bergman": { g24: 26, g23: 24, age: 24 },
  "Adam Saad": { g24: 18, g23: 25, age: 31 },
  "Archie Roberts": { g24: 4, g23: null, age: 20 },
  "Ned Long": { g24: 7, g23: 4, age: 23 },
  "Jarman Impey": { g24: 25, g23: 22, age: 30 },
  "Daniel Rioli": { g24: 23, g23: 23, age: 28 },
  "Colby McKercher": { g24: 16, g23: null, age: 20 },
  "Josh Ward": { g24: 12, g23: 16, age: 22 },
  "Toby Greene": { g24: 24, g23: 24, age: 32 },
  "Sam Banks": { g24: 15, g23: 6, age: 22 },
  "Harris Andrews": { g24: 26, g23: 26, age: 29 },
  "Brent Daniels": { g24: 24, g23: 20, age: 26 },
  "Matt Flynn": { g24: 4, g23: 9, age: 28 },
  "Trent Rivers": { g24: 23, g23: 25, age: 24 },
  "Dion Prestia": { g24: 13, g23: 20, age: 33 },
  "George Wardlaw": { g24: 18, g23: 8, age: 21 },
  "Marcus Windhager": { g24: 15, g23: 19, age: 22 },
  "James Peatling": { g24: 19, g23: 10, age: 25 },
  "Willem Drew": { g24: 26, g23: 25, age: 27 },
  "Xavier Duursma": { g24: 15, g23: 16, age: 25 },
  "Brayden Maynard": { g24: 23, g23: 25, age: 29 },
  "James Rowbottom": { g24: 24, g23: 24, age: 25 },
  "Kane McAuliffe": { g24: 9, g23: null, age: 21 },
  "Mark Blicavs": { g24: 24, g23: 19, age: 34 },
  "Zach Guthrie": { g24: 25, g23: 23, age: 27 },
  "Sam Taylor": { g24: 18, g23: 18, age: 26 },
  "Shai Bolton": { g24: 22, g23: 23, age: 27 },
  "Ben Keays": { g24: 23, g23: 23, age: 29 },
  "Josh Battle": { g24: 23, g23: 23, age: 27 },
  "Wayne Milera": { g24: 3, g23: 22, age: 28 },
  "Jack Silvagni": { g24: null, g23: 16, age: 28 },
  "Josh Rachele": { g24: 22, g23: 21, age: 22 },
  "Aaron Naughton": { g24: 20, g23: 23, age: 26 },
  "Nick Haynes": { g24: 8, g23: 20, age: 33 },
  "Oliver Dempsey": { g24: 25, g23: 5, age: 23 },
  "Ewan Mackinlay": { g24: null, g23: null, age: null },
  "Bailey Humphrey": { g24: 21, g23: 19, age: 21 },
  "Jake Lloyd": { g24: 26, g23: 23, age: 32 },
  "Tom Cole": { g24: 23, g23: 12, age: 28 },
  "Zach Reid": { g24: 1, g23: null, age: 23 },
  "Bailey Williams": { g24: 24, g23: 23, age: 28 },
  "Liam Duggan": { g24: 21, g23: 22, age: 29 },
  "Sean Darcy": { g24: 12, g23: 15, age: 27 },
  "Darcy Fort": { g24: 3, g23: 7, age: 32 },
  "Joel Freijah": { g24: 13, g23: null, age: 20 },
  "Jeremy Howe": { g24: 19, g23: 14, age: 35 },
  "Peter Wright": { g24: 14, g23: 10, age: 29 },
  "Wil Powell": { g24: 18, g23: 18, age: 26 },
  "Lachie Schultz": { g24: 20, g23: 23, age: 28 },
  "Sam Berry": { g24: 18, g23: 4, age: 24 },
  "Josh Treacy": { g24: 20, g23: 17, age: 23 },
  "Tom McDonald": { g24: 22, g23: 8, age: 33 },
  "Riley Bice": { g24: null, g23: null, age: null },
  "Jack Ross": { g24: 7, g23: 19, age: 25 },
  "Dan Houston": { g24: 22, g23: 25, age: 28 },
  "James Worpel": { g24: 25, g23: 23, age: 27 },
  "Paul Curtis": { g24: 23, g23: 21, age: 22 },
  "Lachlan Cowan": { g24: 17, g23: 7, age: 21 },
  "Josh Weddle": { g24: 25, g23: 17, age: 21 },
  "Jacob Weitering": { g24: 22, g23: 26, age: 28 },
  "Mark Keane": { g24: 21, g23: 5, age: 25 },
  "Alex Davies": { g24: 7, g23: 9, age: 23 },
  "Alex Neal-Bullen": { g24: 23, g23: 25, age: 30 },
  "Jack Ginnivan": { g24: 23, g23: 14, age: 23 },
  "Hunter Clark": { g24: 11, g23: 19, age: 26 },
  "Henry Hustwaite": { g24: 4, g23: 2, age: 21 },
  "Jamie Elliott": { g24: 15, g23: 24, age: 33 },
  "Jesse Hogan": { g24: 25, g23: 23, age: 31 },
  "Cam Mackenzie": { g24: 20, g23: 14, age: 22 },
  "Conor Nash": { g24: 25, g23: 23, age: 27 },
  "Bodhi Uwland": { g24: 21, g23: 3, age: 22 },
  "Esava Ratugolea": { g24: 23, g23: 16, age: 27 },
  "Mitchell Hinge": { g24: 22, g23: 22, age: 27 },
  "James Harmes": { g24: 9, g23: 9, age: 30 },
  "Patrick Lipinski": { g24: 23, g23: 14, age: 27 },
  "Oliver Hollands": { g24: 23, g23: 19, age: 22 },
  "Harry Rowston": { g24: null, g23: 7, age: 21 },
  "Max Hall": { g24: null, g23: null, age: null },
  "Lawson Humphries": { g24: 11, g23: null, age: 23 },
  "Blake Hardwick": { g24: 25, g23: 23, age: 29 },
  "Daniel Curtin": { g24: 7, g23: null, age: 20 },
  "Nick Bryan": { g24: 5, g23: 8, age: 24 },
  "Kade Chandler": { g24: 23, g23: 23, age: 26 },
  "Neil Erasmus": { g24: 4, g23: 14, age: 22 },
  "Zac Williams": { g24: 19, g23: null, age: 31 },
  "Tylar Young": { g24: 9, g23: 19, age: 27 },
  "Jase Burgoyne": { g24: 23, g23: 5, age: 22 },
  "Tim Kelly": { g24: 20, g23: 22, age: 31 },
  "Jack Bowes": { g24: 22, g23: 17, age: 28 },
  "Jack Buckley": { g24: 23, g23: 26, age: 28 },
  "Matthew Cottrell": { g24: 14, g23: 17, age: 26 },
  "Darcy Jones": { g24: 14, g23: null, age: 21 },
  "Sam Flanders": { g24: 22, g23: 14, age: 24 },
  "Harvey Langford": { g24: null, g23: null, age: null },
  "Ryley Sanders": { g24: 14, g23: null, age: 21 },
  "Cam Rayner": { g24: 27, g23: 26, age: 26 },
  "Jack Scrimshaw": { g24: 24, g23: 16, age: 27 },
  "Mitch Georgiades": { g24: 20, g23: 2, age: 24 },
  "Levi Ashcroft": { g24: null, g23: null, age: null },
  "Connor Macdonald": { g24: 25, g23: 21, age: 23 },
  "Matthew Johnson": { g24: 19, g23: 18, age: 22 },
  "Reuben Ginbey": { g24: 23, g23: 17, age: 21 },
  "Bradley Hill": { g24: 22, g23: 22, age: 32 },
  "Daniel Turner": { g24: 15, g23: 2, age: 24 },
  "Cooper Lord": { g24: 2, g23: null, age: 20 },
  "Ed Langdon": { g24: 22, g23: 25, age: 30 },
  "Keidean Coleman": { g24: 1, g23: 23, age: 25 },
  "Luke McDonald": { g24: 22, g23: 22, age: 31 },
  "Mason Wood": { g24: 18, g23: 24, age: 32 },
  "Sam Collins": { g24: 23, g23: 23, age: 31 },
  "Harry Morrison": { g24: 12, g23: 13, age: 27 },
  "Cooper Trembath": { g24: null, g23: null, age: null },
  "Corey Wagner": { g24: 12, g23: 9, age: 28 },
  "Aliir Aliir": { g24: 25, g23: 24, age: 31 },
  "Nick Larkey": { g24: 23, g23: 23, age: 27 },
  "Mitch McGovern": { g24: 18, g23: 22, age: 31 },
  "Changkuoth Jiath": { g24: 11, g23: 8, age: 26 },
  "Hugo Garcia": { g24: 9, g23: null, age: 20 },
  "Jack Henry": { g24: 25, g23: 11, age: 27 },
  "Charlie Curnow": { g24: 21, g23: 26, age: 29 },
  "Brandon Walker": { g24: 19, g23: 14, age: 23 },
  "Rhylee West": { g24: 21, g23: 12, age: 25 },
  "Massimo D'Ambrosio": { g24: 24, g23: 8, age: 22 },
  "Ryan Angwin": { g24: 4, g23: 15, age: 23 },
  "Harley Reid": { g24: 20, g23: null, age: 20 },
  "Jack Payne": { g24: 18, g23: 23, age: 26 },
  "Ben Miller": { g24: 21, g23: 13, age: 26 },
  "Tom Papley": { g24: 21, g23: 23, age: 29 },
  "Jake Riccardi": { g24: 19, g23: 21, age: 26 },
  "Cooper Sharman": { g24: 18, g23: 16, age: 25 },
  "Mac Andrew": { g24: 20, g23: 17, age: 22 },
  "Alex Pearce": { g24: 15, g23: 23, age: 30 },
  "Joe Richards": { g24: 9, g23: null, age: 26 },
  "Blake Acres": { g24: 23, g23: 25, age: 30 },
  "Tom McCartin": { g24: 22, g23: 15, age: 26 },
  "Clay Hall": { g24: 3, g23: null, age: 20 },
  "Sam Powell-Pepper": { g24: 3, g23: 25, age: 28 },
  "Jaxon Prior": { g24: 4, g23: 5, age: 24 },
  "Darcy Byrne-Jones": { g24: 26, g23: 23, age: 30 },
  "Sam Switkowski": { g24: 20, g23: 22, age: 29 },
  "Taylor Walker": { g24: 18, g23: 22, age: 35 },
  "Ned Moyle": { g24: 8, g23: 2, age: 24 },
  "Hugh Boxshall": { g24: null, g23: null, age: null },
  "Harry Perryman": { g24: 21, g23: 22, age: 27 },
  "Murphy Reid": { g24: null, g23: null, age: null },
  "Rhys Stanley": { g24: 14, g23: 13, age: 35 },
  "Jed Bews": { g24: 5, g23: 15, age: 32 },
  "Brady Hough": { g24: 23, g23: 15, age: 22 },
  "Will Lorenz": { g24: 2, g23: null, age: 21 },
  "Mabior Chol": { g24: 23, g23: 8, age: 29 },
  "Will Hayward": { g24: 26, g23: 23, age: 27 },
  "Jack Martin": { g24: 3, g23: 13, age: 31 },
  "Bayley Fritsch": { g24: 23, g23: 17, age: 29 },
  "Lachlan Bramble": { g24: 24, g23: 11, age: 27 },
  "Isaac Quaynor": { g24: 23, g23: 26, age: 26 },
  "Ryan Lester": { g24: 27, g23: 19, age: 33 },
  "Sam De Koning": { g24: 19, g23: 19, age: 25 },
  "Callum Brown": { g24: 13, g23: 19, age: 25 },
  "Cameron Zurhaar": { g24: 22, g23: 16, age: 27 },
  "Jai Culley": { g24: 3, g23: 5, age: 23 },
  "Hugo Ralphsmith": { g24: 18, g23: 13, age: 24 },
  "Nathan Broad": { g24: 22, g23: 19, age: 32 },
  "Jaeger O'Meara": { g24: 22, g23: 21, age: 32 },
  "Darcy Moore": { g24: 23, g23: 24, age: 30 },
  "Tyson Stengle": { g24: 25, g23: 19, age: 27 },
  "Jayden Laverde": { g24: 21, g23: 19, age: 29 },
  "Tom Brown": { g24: 18, g23: 1, age: 22 },
  "Rory Lobb": { g24: 16, g23: 20, age: 33 },
  "Anthony Caminiti": { g24: 15, g23: 18, age: 22 },
  "Francis Evans": { g24: 17, g23: 10, age: 24 },
  "Oskar Baker": { g24: 6, g23: 18, age: 27 },
  "Jordan De Goey": { g24: 13, g23: 21, age: 29 },
  "Logan Evans": { g24: 13, g23: null, age: 20 },
  "Noah Answerth": { g24: 16, g23: 4, age: 26 },
  "Elijah Hewett": { g24: null, g23: 14, age: 21 },
  "Jake Melksham": { g24: 8, g23: 13, age: 34 },
  "Seth Campbell": { g24: 21, g23: null, age: 21 },
  "Jacob Wehr": { g24: 11, g23: 4, age: 27 },
  "Shannon Neale": { g24: 15, g23: 3, age: 23 },
  "Jake Lever": { g24: 18, g23: 24, age: 29 },
  "Mitch Owens": { g24: 23, g23: 23, age: 22 },
  "Callum Ah Chee": { g24: 26, g23: 12, age: 28 },
  "Nick Watson": { g24: 18, g23: null, age: 21 },
  "Isaac Cumming": { g24: 6, g23: 20, age: 27 },
  "Ben Long": { g24: 17, g23: 15, age: 28 },
  "Aaron Cadman": { g24: 23, g23: 12, age: 21 },
  "Mitch Lewis": { g24: 4, g23: 15, age: 27 },
  "Jy Farrar": { g24: null, g23: 9, age: 29 },
  "Riley Garcia": { g24: 12, g23: 3, age: 25 },
  "Harvey Thomas": { g24: 22, g23: null, age: 20 },
  "Ben King": { g24: 22, g23: 20, age: 25 },
  "Hayden McLean": { g24: 26, g23: 22, age: 27 },
  "Dylan Stephens": { g24: 16, g23: 13, age: 25 },
  "Daniel McStay": { g24: 5, g23: 14, age: 30 },
  "Jordan Croft": { g24: null, g23: null, age: null },
  "Brody Mihocek": { g24: 11, g23: 24, age: 33 },
  "Connor O'Sullivan": { g24: 1, g23: null, age: 20 },
  "Dane Rampe": { g24: 21, g23: 15, age: 35 },
  "Mark O'Connor": { g24: 13, g23: 22, age: 29 },
  "Darcy Wilson": { g24: 23, g23: null, age: 20 },
  "Campbell Gray": { g24: null, g23: null, age: null },
  "Will Graham": { g24: 17, g23: null, age: 20 },
  "Lachie Fogarty": { g24: 15, g23: 12, age: 26 },
  "Oliver Florent": { g24: 26, g23: 24, age: 27 },
  "Edward Allan": { g24: 2, g23: null, age: 21 },
  "Sam Clohesy": { g24: 20, g23: null, age: 23 },
  "Heath Chapman": { g24: 16, g23: 3, age: 24 },
  "Ned Reeves": { g24: 4, g23: 21, age: 27 },
  "Dougal Howard": { g24: 15, g23: 18, age: 29 },
  "Lewis Hayes": { g24: null, g23: null, age: null },
  "Sam Davidson": { g24: null, g23: null, age: null },
  "Stephen Coniglio": { g24: 15, g23: 25, age: 32 },
  "Ryan Byrnes": { g24: 15, g23: 20, age: 24 },
  "Jake Waterman": { g24: 20, g23: 11, age: 27 },
  "Dante Visentini": { g24: 3, g23: 3, age: 23 },
  "Jake Stringer": { g24: 23, g23: 17, age: 31 },
  "Xavier O'Halloran": { g24: 19, g23: 15, age: 25 },
  "Campbell Chesser": { g24: 18, g23: 14, age: 22 },
  "Max Ramsden": { g24: 3, g23: 2, age: 22 },
  "Nathan O'Driscoll": { g24: 2, g23: 10, age: 23 },
  "Logan Morris": { g24: 19, g23: null, age: 20 },
  "Aidan Corr": { g24: 23, g23: 19, age: 31 },
  "James Jordon": { g24: 26, g23: 18, age: 25 },
  "Lachie Weller": { g24: 6, g23: 9, age: 30 },
  "Brad Close": { g24: 25, g23: 21, age: 27 },
  "James Trezise": { g24: 7, g23: 1, age: 23 },
  "Joel Amartey": { g24: 25, g23: 15, age: 26 },
  "Riley Hardeman": { g24: 3, g23: null, age: 21 },
  "Noah Balta": { g24: 19, g23: 23, age: 26 },
  "Sandy Brock": { g24: null, g23: null, age: null },
  "Toby Bedford": { g24: 23, g23: 19, age: 25 },
  "Liam Ryan": { g24: 16, g23: 3, age: 29 },
  "Jacob van Rooyen": { g24: 21, g23: 20, age: 22 },
  "Griffin Logue": { g24: 2, g23: 15, age: 27 },
  "Cooper Simpson": { g24: 2, g23: null, age: 21 },
  "Brayden Cook": { g24: 15, g23: 1, age: 23 },
  "Beau McCreery": { g24: 17, g23: 25, age: 24 },
  "Harry O'Farrell": { g24: null, g23: null, age: null },
  "Max Michalanney": { g24: 23, g23: 22, age: 22 },
  "Bailey Banfield": { g24: 22, g23: 14, age: 28 },
  "Jack Williams": { g24: 18, g23: 10, age: 22 },
  "Billy Frampton": { g24: 18, g23: 16, age: 29 },
  "Mitch Knevitt": { g24: 4, g23: 8, age: 23 },
  "Lachlan Sholl": { g24: 20, g23: 16, age: 25 },
  "Harry Edwards": { g24: 9, g23: 2, age: 25 },
  "Lewis Young": { g24: 9, g23: 15, age: 27 },
  "Tom Barrass": { g24: 18, g23: 14, age: 30 },
  "Darcy Fogarty": { g24: 23, g23: 21, age: 26 },
  "Charlie Comben": { g24: 19, g23: 7, age: 24 },
  "Ben Ainsworth": { g24: 17, g23: 21, age: 28 },
  "Jamie Cripps": { g24: 23, g23: 12, age: 33 },
  "Zac Fisher": { g24: 18, g23: 12, age: 27 },
  "Xavier Lindsay": { g24: null, g23: null, age: null },
  "Tom Sparrow": { g24: 21, g23: 23, age: 25 },
  "Sam Lalor": { g24: null, g23: null, age: null },
  "Jade Gresham": { g24: 22, g23: 23, age: 28 },
  "Buku Khamis": { g24: 17, g23: 1, age: 25 },
  "Jack Darling": { g24: 21, g23: 20, age: 33 },
  "Karl Worner": { g24: 4, g23: 4, age: 23 },
  "Rhyan Mansell": { g24: 21, g23: 17, age: 25 },
  "Toby McMullin": { g24: 14, g23: 3, age: 21 },
  "Darcy Gardiner": { g24: 7, g23: 4, age: 30 },
  "Patrick Voss": { g24: 7, g23: null, age: 22 },
  "Jack Higgins": { g24: 20, g23: 22, age: 26 },
  "Braeden Campbell": { g24: 23, g23: 23, age: 24 },
  "Brandon Zerk-Thatcher": { g24: 26, g23: 22, age: 27 },
  "Angus Clarke": { g24: null, g23: null, age: null },
  "Lucca Grego": { g24: null, g23: null, age: null },
  "Brennan Cox": { g24: 9, g23: 20, age: 27 },
  "Bobby Hill": { g24: 23, g23: 24, age: 26 },
  "Michael Frederick": { g24: 20, g23: 19, age: 25 },
  "Oscar Allen": { g24: 11, g23: 23, age: 26 },
  "Sam Butler": { g24: 2, g23: 8, age: 23 },
  "Archie Perkins": { g24: 18, g23: 23, age: 23 },
  "Zak Johnson": { g24: null, g23: null, age: null },
  "Toby Pink": { g24: 15, g23: null, age: 27 },
  "Finn O'Sullivan": { g24: null, g23: null, age: null },
  "Harry Cunningham": { g24: 23, g23: 24, age: 32 },
  "Jack Lukosius": { g24: 21, g23: 22, age: 25 },
  "Elijah Tsatas": { g24: 7, g23: 4, age: 21 },
  "Max Heath": { g24: null, g23: null, age: null },
  "Tom Gross": { g24: null, g23: null, age: null },
  "Tim Membrey": { g24: 19, g23: 7, age: 31 },
  "Lachie Jones": { g24: 21, g23: 15, age: 23 },
  "Caiden Cleary": { g24: 5, g23: null, age: 20 },
  "Luke Cleary": { g24: 2, g23: 1, age: 23 },
  "Charlie Cameron": { g24: 27, g23: 26, age: 31 },
  "Harrison Petty": { g24: 20, g23: 14, age: 26 },
  "Judd McVee": { g24: 23, g23: 25, age: 22 },
  "Jack Hutchinson": { g24: 7, g23: null, age: 24 },
  "Caleb Windsor": { g24: 19, g23: null, age: 20 },
  "Lewis Melican": { g24: 24, g23: 8, age: 29 },
  "Kyle Langford": { g24: 23, g23: 23, age: 29 },
  "Isaiah Dudley": { g24: null, g23: null, age: null },
  "Luke Trainor": { g24: null, g23: null, age: null },
  "Kai Lohmann": { g24: 27, g23: 6, age: 22 },
  "Tom Lynch": { g24: 4, g23: 4, age: 33 },
  "Sam Wicks": { g24: 16, g23: 11, age: 26 },
  "James O'Donnell": { g24: 14, g23: 12, age: 23 },
  "Vigo Visentini": { g24: null, g23: null, age: null },
  "Eric Hipwood": { g24: 24, g23: 26, age: 28 },
  "Oscar McDonald": { g24: 1, g23: null, age: 29 },
  "Josh Sinn": { g24: 6, g23: 3, age: 23 },
  "Archer May": { g24: null, g23: null, age: null },
  "Blake Howes": { g24: 16, g23: null, age: 22 },
  "Liam Stocker": { g24: 16, g23: 23, age: 26 },
  "Isaac Kako": { g24: null, g23: null, age: null },
  "Joe Fonti": { g24: 5, g23: null, age: 21 },
  "Hamish Davis": { g24: null, g23: null, age: null },
  "Taj Hotton": { g24: null, g23: null, age: null },
  "Billy Dowling": { g24: 9, g23: null, age: 21 },
  "Sam Marshall": { g24: null, g23: null, age: null },
  "Laitham Vandermeer": { g24: 24, g23: 11, age: 27 },
  "Bruce Reville": { g24: 12, g23: null, age: 25 },
  "Christian Moraes": { g24: null, g23: null, age: null },
  "Matthew Carroll": { g24: null, g23: null, age: null },
  "Saad El-Hawli": { g24: null, g23: null, age: null },
  "Lucas Camporeale": { g24: null, g23: null, age: null },
  "Reef McInnes": { g24: 9, g23: 5, age: 23 },
  "Malcolm Rosas": { g24: 7, g23: 19, age: 24 },
  "Lachlan Blakiston": { g24: null, g23: null, age: null },
  "Calsher Dear": { g24: 17, g23: null, age: 20 },
  "Leek Aleer": { g24: 8, g23: null, age: 24 },
  "Maurice Rioli": { g24: 9, g23: 10, age: 23 },
  "Kaleb Smith": { g24: 4, g23: null, age: 21 },
  "Rhett Bazzo": { g24: 1, g23: 11, age: 22 },
  "Tyler Brockman": { g24: 10, g23: 15, age: 23 },
  "Tom Hanily": { g24: null, g23: null, age: null },
  "Nate Caddy": { g24: 10, g23: null, age: 20 },
  "Jack Buller": { g24: null, g23: 1, age: 24 },
  "Peter Ladhams": { g24: 1, g23: 9, age: 28 },
  "Jackson Mead": { g24: 26, g23: 7, age: 24 },
  "Jedd Busslinger": { g24: null, g23: null, age: null },
  "Jesse Motlop": { g24: 7, g23: 21, age: 22 },
  "Bailey J. Williams": { g24: 24, g23: 23, age: null },
  "Brandon Starcevich": { g24: 21, g23: 26, age: 26 },
  "Finn Maginness": { g24: 13, g23: 13, age: 25 },
  "Alixzander Tauru": { g24: null, g23: null, age: null },
  "Tyler Sonsie": { g24: 14, g23: 3, age: 23 },
  "Corey Durdin": { g24: 14, g23: 11, age: 23 },
  "Jhye Clark": { g24: 15, g23: 1, age: 21 },
  "Mani Liddy": { g24: null, g23: null, age: null },
  "Matt Guelfi": { g24: 13, g23: 13, age: 28 },
  "Bailey Scott": { g24: 23, g23: 23, age: 25 },
  "Lachlan Sullivan": { g24: 10, g23: null, age: 28 },
  "Luke Nankervis": { g24: 20, g23: 4, age: 22 },
  "Billy Wilson": { g24: null, g23: null, age: null },
  "Lachlan McNeil": { g24: 12, g23: 13, age: 25 },
  "Tobie Travaglia": { g24: null, g23: null, age: null },
  "Jack Henderson": { g24: null, g23: null, age: null },
  "Jobe Shanahan": { g24: null, g23: null, age: null },
  "Jeremy Sharp": { g24: 23, g23: null, age: 24 },
  "Tom Doedee": { g24: null, g23: 11, age: 29 },
  "Tyrell Dewar": { g24: 7, g23: null, age: 21 },
  "Ethan Read": { g24: 4, g23: null, age: 20 },
  "Charlie Spargo": { g24: 1, g23: 14, age: 26 },
  "Harrison Jones": { g24: 21, g23: 5, age: 25 },
  "Lachlan Gulbin": { g24: null, g23: null, age: null },
  "Oliver Henry": { g24: 23, g23: 22, age: 23 },
  "Hudson O'Keeffe": { g24: null, g23: null, age: null },
  "Nick Coffield": { g24: 8, g23: null, age: 26 },
  "Cooper Harvey": { g24: null, g23: 3, age: 21 },
  "Flynn Young": { g24: null, g23: null, age: null },
  "Sid Draper": { g24: 16, g23: 14, age: null },
  "Zac Taylor": { g24: 9, g23: null, age: 23 },
  "Connor Budarick": { g24: 8, g23: 2, age: 24 },
  "Luke Pedlar": { g24: 4, g23: 21, age: 23 },
  "Corey Warner": { g24: 6, g23: 3, age: 22 },
  "Jackson Archer": { g24: 15, g23: 5, age: 23 },
  "Ty Gallop": { g24: null, g23: null, age: null },
  "Conor Stone": { g24: 4, g23: 3, age: 23 },
  "Jordan Boyd": { g24: 19, g23: 9, age: 27 },
  "Thomas Edwards": { g24: null, g23: null, age: null },
  "Jacob Newton": { g24: null, g23: null, age: null },
  "Joel Hamling": { g24: null, g23: 4, age: 32 },
  "Nick Holman": { g24: 21, g23: 19, age: 30 },
  "Jake Rogers": { g24: 9, g23: null, age: 20 },
  "Jye Amiss": { g24: 22, g23: 22, age: 22 },
  "Joe Berry": { g24: 27, g23: 25, age: null },
  "Brodie Kemp": { g24: 21, g23: 17, age: 24 },
  "Harvey Gallagher": { g24: 20, g23: null, age: 22 },
  "Conor McKenna": { g24: 18, g23: 26, age: 29 },
  "Jack Carroll": { g24: 15, g23: 1, age: 23 },
  "Nick Murray": { g24: 9, g23: 17, age: 25 },
  "Matthew Owies": { g24: 23, g23: 18, age: 28 },
  "Max Gruzewski": { g24: 4, g23: null, age: 21 },
  "Tom Cochrane": { g24: null, g23: null, age: null },
  "Joshua Draper": { g24: 20, g23: null, age: 22 },
  "Ben McKay": { g24: 23, g23: 19, age: 28 },
  "Bo Allan": { g24: null, g23: null, age: null },
  "Dan Butler": { g24: 16, g23: 24, age: 29 },
  "Liam McMahon": { g24: null, g23: null, age: null },
  "Ashton Moir": { g24: 2, g23: null, age: 20 },
  "Jordon Butts": { g24: 15, g23: 17, age: 26 },
  "Jed Walter": { g24: 14, g23: null, age: 20 },
  "Archer Reid": { g24: null, g23: null, age: null },
  "Roan Steele": { g24: null, g23: null, age: null },
  "Henry Smith": { g24: 4, g23: null, age: 23 },
  "Jacob Konstanty": { g24: null, g23: null, age: null },
  "Wil Dawson": { g24: 3, g23: null, age: 20 },
  "Mattaes Phillipou": { g24: 13, g23: 24, age: 21 },
  "Oisin Mullin": { g24: 12, g23: 6, age: 26 },
  "William Hayes": { g24: null, g23: null, age: null },
  "Hugh Bond": { g24: 7, g23: null, age: 21 },
  "Koltyn Tholstrup": { g24: 10, g23: null, age: 20 },
  "Mason Cox": { g24: 16, g23: 19, age: 34 },
  "Josh Gibcus": { g24: 2, g23: null, age: 22 },
  "Ollie Lord": { g24: 6, g23: 13, age: 24 },
  "Jonty Faull": { g24: null, g23: null, age: null },
  "Steely Green": { g24: 6, g23: null, age: 22 },
  "Wil Parker": { g24: 5, g23: null, age: 23 },
  "Liam O'Connell": { g24: null, g23: null, age: null },
  "Noah Long": { g24: 7, g23: 19, age: 21 },
  "James Borlase": { g24: 10, g23: 4, age: 23 },
  "Jack Whitlock": { g24: null, g23: null, age: null },
  "Jesse Dattoli": { g24: null, g23: null, age: null },
  "Isaac Keeler": { g24: null, g23: null, age: null },
  "Robert Hansen Jr": { g24: null, g23: null, age: null },
  "Finnbar Maley": { g24: null, g23: null, age: null },
  "Jayden Nguyen": { g24: null, g23: null, age: null },
  "Thomas Sims": { g24: null, g23: null, age: null },
  "Lance Collard": { g24: 3, g23: null, age: 20 },
  "Zane Duursma": { g24: 13, g23: null, age: 20 },
  "Harry Sharp": { g24: 6, g23: 3, age: 23 },
  "Cooper Hynes": { g24: null, g23: null, age: null },
  "Oscar Adams": { g24: null, g23: null, age: null },
  "Matthew Jefferson": { g24: null, g23: null, age: null },
  "Harry Armstrong": { g24: null, g23: null, age: null },
  "Angus Hastie": { g24: 5, g23: null, age: 20 },
  "Josh Dolan": { g24: null, g23: null, age: null }
};

/* =========================================================
   INJURY DATA — 2026 Pre-Season (refreshed 26 Feb 2026)
   Sources: SEN, AFL.com.au, The Mongrel Punt, Zero Hanger
   status: season/months/weeks/doubt/managed/available
   mr: estimated missed rounds (0-24)
   ========================================================= */
const INJURY_DATA = {
  // SEASON — DO NOT DRAFT (updated 2026-02-26)
  "Tom Green":          { s: "season", i: "ACL", d: "Out entire 2026 season", mr: 24 },
  "Nic Martin":         { s: "season", i: "Knee (ACL)", d: "Out entire 2026 season", mr: 24 },
  "Josh Kelly":         { s: "season", i: "Hip surgery", d: "Out majority of year", mr: 20 },
  "Harry O'Farrell":    { s: "season", i: "Knee", d: "Out for majority of season", mr: 20 },
  "Bobby Hill":         { s: "season", i: "Personal", d: "Extended leave, not in 2026 plans", mr: 24 },
  "Jesse Motlop":       { s: "season", i: "Ruptured ACL", d: "Out entire 2026 season", mr: 24 },
  "Jackson Archer":     { s: "season", i: "ACL", d: "Ruled out entire 2026 season", mr: 24 },
  "Harley Barker":      { s: "season", i: "ACL", d: "Expected to miss majority of season", mr: 20 },
  "Noah Long":          { s: "season", i: "Multi-ligament knee", d: "Season over, surgery required (Feb 22 match sim)", mr: 24 },
  "Ivan Soldo":         { s: "season", i: "Ruptured ACL", d: "Out entire 2026 season", mr: 24 },
  "James Harmes":       { s: "season", i: "Retired", d: "Retired from AFL", mr: 24 },
  // MONTHS — Major risk
  "Will Day":           { s: "months", i: "Shoulder + foot stress", d: "Targeting Round 14 return (shoulder), foot also managed", mr: 13 },
  "Jake Bowey":         { s: "months", i: "Lisfranc fracture", d: "Out majority of 2026", mr: 16 },
  "Jack Viney":         { s: "months", i: "Achilles surgery", d: "Out most of first half", mr: 12 },
  "Mark Keane":         { s: "months", i: "Broken ankle", d: "Out several months", mr: 10 },
  "Daniel Curtin":      { s: "months", i: "Dislocated kneecap", d: "Not expected until Round 7", mr: 6 },
  "Darcy Jones":        { s: "months", i: "ACL recovery", d: "Unlikely until deep in season", mr: 16 },
  "Jack Payne":         { s: "months", i: "Ruptured patella", d: "Targeting Round 6", mr: 5 },
  "Sam Powell-Pepper":  { s: "months", i: "ACL recovery", d: "Expected mid-season", mr: 12 },
  "Riley Garcia":       { s: "months", i: "Hamstring", d: "10-14 weeks sidelined", mr: 10 },
  "Eric Hipwood":       { s: "months", i: "Ruptured ACL", d: "Targeting second half return", mr: 14 },
  "Tom Cochrane":       { s: "months", i: "Hamstring", d: "Out two months", mr: 8 },
  "Cody Weightman":     { s: "months", i: "Knee (bipartite patella)", d: "April earliest", mr: 6 },
  "Jake Kolodjashnij":  { s: "months", i: "Hip", d: "On injury list", mr: 10 },
  "Elliott Himmelberg":  { s: "months", i: "Ruptured ACL", d: "Hoping mid-season return", mr: 12 },
  "Sam Sturt":          { s: "months", i: "ACL recovery", d: "Sidelined until Round 10+", mr: 10 },
  "Blake Thredgold":    { s: "months", i: "Lisfranc", d: "Out first six months", mr: 16 },
  "Judson Clarke":      { s: "months", i: "ACL rupture", d: "Mid-year return", mr: 12 },
  "Tom Sims":           { s: "months", i: "Foot (navicular)", d: "Not yet running", mr: 14 },
  "Shane McAdam":       { s: "months", i: "Torn Achilles", d: "No timeline", mr: 14 },
  "Will Ashcroft":      { s: "months", i: "Knee", d: "Targeting Round 12 return", mr: 11 },
  "Sam Allen":          { s: "months", i: "ACL tear", d: "Expected to miss season start", mr: 10 },
  "Taj Hotton":         { s: "months", i: "Hip (bone stress)", d: "Set to miss first four months", mr: 10 },
  // WEEKS — Will miss start of season
  "Matt Rowell":        { s: "weeks", i: "Broken finger (surgery)", d: "Surgery confirmed, post-bye return ~Round 4", mr: 3 },
  "Adam Cerra":         { s: "weeks", i: "Hamstring strain", d: "Left match sim Q3, miss opening rounds", mr: 3 },
  "Finn Callaghan":     { s: "weeks", i: "Hip flexor", d: "Chance for Round 1 with management", mr: 2 },
  "Ed Richards":        { s: "weeks", i: "Shoulder", d: "On injury list", mr: 3 },
  "Izak Rankine":       { s: "weeks", i: "Suspension + hamstring", d: "Returns Round 2, also hamstring concern", mr: 2 },
  "Jordan Ridley":      { s: "weeks", i: "Calf", d: "Expected to miss six weeks per SEN", mr: 6 },
  "Ollie Wines":        { s: "weeks", i: "Suspension", d: "Will miss first two rounds", mr: 2 },
  "Liam Baker":         { s: "weeks", i: "Suspension", d: "Will miss Round 2", mr: 1 },
  "Sam Draper":         { s: "weeks", i: "Foot stress reaction", d: "Will miss Round 1", mr: 1 },
  "Will Setterfield":   { s: "weeks", i: "Knee", d: "Working towards full training", mr: 4 },
  "George Wardlaw":     { s: "weeks", i: "Hamstring (re-aggravated)", d: "Worse hamstring, out a month", mr: 4 },
  "Dion Prestia":       { s: "weeks", i: "Hamstring strain", d: "Not playing practice games", mr: 3 },
  "Sam Taylor":         { s: "weeks", i: "Hamstring (high-grade)", d: "High-grade sprain from Origin, miss first part of season", mr: 6 },
  "Nick Haynes":        { s: "weeks", i: "Ankle", d: "Assessed after Round 2 bye", mr: 3 },
  "Bailey Williams":    { s: "weeks", i: "Groin", d: "Modified program", mr: 3 },
  "Jeremy Howe":        { s: "weeks", i: "Calf (re-aggravated)", d: "May miss opening rounds", mr: 3 },
  "Jesse Hogan":        { s: "weeks", i: "Foot", d: "On injury list", mr: 4 },
  "Nick Bryan":         { s: "weeks", i: "ACL recovery", d: "Expected Round 5-6 return per Brad Scott", mr: 5 },
  "Matthew Cottrell":   { s: "weeks", i: "Knee", d: "Assessed after Round 2", mr: 3 },
  "Ryley Sanders":      { s: "weeks", i: "Bilateral hamstring", d: "Limited pre-season", mr: 3 },
  "Hugo Ralphsmith":    { s: "weeks", i: "Hamstring", d: "Working back to fitness", mr: 3 },
  "Tyson Stengle":      { s: "weeks", i: "Personal", d: "Confirmed miss Opening Round, no firm return date", mr: 4 },
  // Noah Answerth upgraded to MANAGED (returned to training, SEN 24/02)
  "Toby Bedford":       { s: "weeks", i: "Hamstring", d: "Out 4-6 weeks", mr: 4 },
  "Archie Perkins":     { s: "weeks", i: "Groin", d: "Working towards full training", mr: 3 },
  "Max King":           { s: "months", i: "Back stress fractures", d: "SYD rookie, up to 6 months out", mr: 14 },
  "Toby Conway":        { s: "weeks", i: "Foot/knee", d: "Won't be rushed back", mr: 4 },
  "Harry Cunningham":   { s: "weeks", i: "Quad", d: "Out 3-5 weeks", mr: 4 },
  "Elijah Hewett":      { s: "weeks", i: "Calf", d: "Working back", mr: 3 },
  "Reef McInnes":       { s: "weeks", i: "ACL recovery", d: "Return early in season", mr: 4 },
  "Isaac Kako":         { s: "weeks", i: "Hamstring strain", d: "Missing pre-season games", mr: 2 },
  "Josh Smillie":       { s: "weeks", i: "Quad/conditioning", d: "Round 1 unlikely", mr: 3 },
  "Aidan Corr":         { s: "weeks", i: "Calf", d: "Will miss training chunk", mr: 3 },
  "Riley Hardeman":     { s: "weeks", i: "Ankle", d: "Injured in practice match", mr: 3 },
  "Lachie Sullivan":    { s: "weeks", i: "Knee", d: "Cleared to train with rehab group", mr: 3 },
  "Harry Jones":        { s: "weeks", i: "Ankle", d: "Working towards full training", mr: 3 },
  "Charlie Ballard":    { s: "weeks", i: "ACL recovery", d: "Miss Round 1, available shortly after", mr: 1 },
  "Tom Edwards":        { s: "weeks", i: "ACL recovery", d: "Likely to miss opening stages", mr: 4 },
  "Lewis Hayes":        { s: "weeks", i: "ACL recovery", d: "Likely to miss opening stages", mr: 4 },
  "Taylor Adams":       { s: "weeks", i: "Achilles/concussion", d: "Likely miss season opener", mr: 2 },
  "Laitham Vandermeer": { s: "weeks", i: "Achilles", d: "2-3 weeks away", mr: 3 },
  "Jack Hutchinson":    { s: "weeks", i: "Ankle (post-surgery)", d: "Remains sidelined", mr: 4 },
  "Matthew Carroll":    { s: "weeks", i: "Hamstring", d: "Recent intraclub injury", mr: 3 },
  "Brandon Zerk-Thatcher": { s: "weeks", i: "Heel", d: "On injury list", mr: 3 },
  "Bailey Laurie":      { s: "weeks", i: "Hand (fractured)", d: "On injury list", mr: 4 },
  // Brent Daniels upgraded to DOUBT (eyeing Opening Round, SEN)
  "Gryan Miers":        { s: "weeks", i: "Thumb", d: "Will miss Opening Round", mr: 1 },
  "Ned Bowman":         { s: "weeks", i: "Hamstring", d: "Will miss approximately eight weeks", mr: 8 },
  // DOUBT — Round 1 uncertain
  "Brodie Grundy":      { s: "doubt", i: "Concussion", d: "Pre-season incident", mr: 0 },
  "Jye Caldwell":       { s: "doubt", i: "Knee concern", d: "Recently addressed", mr: 0 },
  "Jason Horne-Francis": { s: "doubt", i: "Shoulder/foot", d: "Playing preseason, R1 uncertain", mr: 1 },
  "Luke Ryan":          { s: "doubt", i: "Shoulder cleanup", d: "Recently commencing contact", mr: 1 },
  "Adam Treloar":       { s: "doubt", i: "Calf/hamstring", d: "In doubt for Opening Round", mr: 1 },
  // George Wardlaw downgraded to WEEKS (worse hamstring, SEN)
  "Ben Keays":          { s: "doubt", i: "Hamstring", d: "In contention for Round 1", mr: 0 },
  "Liam Duggan":        { s: "doubt", i: "Concussion", d: "Being assessed", mr: 0 },
  "Jacob Weitering":    { s: "doubt", i: "Fractured rib", d: "Good chance for Opening Round", mr: 0 },
  "Mitch Georgiades":   { s: "doubt", i: "Hamstring awareness", d: "Being assessed from Origin", mr: 0 },
  // Brady Hough upgraded to MANAGED (returned to full training, SEN)
  "Callum Ah Chee":     { s: "doubt", i: "Hamstring strain", d: "Chance for Round 1", mr: 0 },
  "Brody Mihocek":      { s: "doubt", i: "Concussion", d: "Debut possibly delayed 1 round", mr: 1 },
  "Joel Amartey":       { s: "doubt", i: "Concussion", d: "Pre-season incident", mr: 0 },
  "Beau McCreery":      { s: "doubt", i: "Foot surgery", d: "Striving for campaign start", mr: 1 },
  "Jack Henderson":     { s: "doubt", i: "Sacrum stress fracture", d: "Pushing for opening weeks", mr: 1 },
  // Tom Doedee upgraded to MANAGED (available by season start, SEN)
  "Charlie Spargo":     { s: "doubt", i: "Shoulder", d: "Building toward Round 1 debut", mr: 1 },
  "Brodie Kemp":        { s: "doubt", i: "Ruptured Achilles", d: "Early-season comeback", mr: 2 },
  "Ollie Florent":      { s: "doubt", i: "Concussion", d: "Entered protocols Jan 30", mr: 0 },
  "Sid Draper":         { s: "doubt", i: "Groin soreness", d: "Light duties", mr: 0 },
  "Elliot Yeo":         { s: "doubt", i: "Multiple (2025)", d: "Match sim, no certainty for R1", mr: 1 },
  "Andy Moniz-Wakefield": { s: "doubt", i: "ACL recovery", d: "Targeting early-season return", mr: 2 },
  "Liam Henry":         { s: "doubt", i: "Hamstring", d: "Scans to confirm severity", mr: 1 },
  "Sam Walsh":          { s: "doubt", i: "Back soreness", d: "Reassess for Opening Round", mr: 0 },
  "Callum Brown":       { s: "doubt", i: "Foot", d: "Came off in Feb 20 match sim", mr: 1 },
  "Jack Macrae":        { s: "doubt", i: "Hamstring", d: "May hinder practice match participation", mr: 1 },
  // Lincoln McCarthy upgraded to MANAGED (full training, SEN)
  "Brent Daniels":      { s: "doubt", i: "Groin surgery recovery", d: "Eyeing Opening Round return", mr: 1 },
  "Tom Barrass":        { s: "doubt", i: "Back", d: "In doubt for Opening Round", mr: 1 },
  "Isaac Cumming":      { s: "doubt", i: "Hamstring (low-grade)", d: "Missed practice match", mr: 1 },
  "Tom Cole":           { s: "doubt", i: "Finger", d: "Recent intraclub injury", mr: 1 },
  "Jeremy Cameron":     { s: "doubt", i: "Quad + broken arm", d: "Quad strain, no certainty for Opening Round", mr: 1 },
  "Darcy Moore":        { s: "doubt", i: "Calf (worsened)", d: "Condition worsened, Opening Round in doubt", mr: 1 },
  "Bailey Dale":        { s: "doubt", i: "Low-grade MCL (knee)", d: "Exited match sim Feb 22, racing for Rd 1", mr: 1 },
  "Lachie Neale":       { s: "doubt", i: "Leg/calf", d: "On Footywire injury list, monitoring", mr: 0 },
  // MANAGED — Expected to play (updated 2026-02-26)
  // Jeremy Cameron downgraded to DOUBT (quad strain, SEN 23/02)
  // Darcy Moore downgraded to DOUBT (calf worsened, SEN)
  "Nick Vlastuin":      { s: "managed", i: "Ankle fracture", d: "Back in main training, hardly missed a beat", mr: 0 },
  // Nic Newman upgraded to AVAILABLE (set for Opening Round, SEN)
  "Jack Graham":        { s: "managed", i: "Hamstring strain", d: "Missed practice match, in line for Round 1", mr: 0 },
  "Tom Gross":          { s: "managed", i: "Hamstring strain", d: "Missed practice match, in line for Round 1", mr: 0 },
  "Brandon Starcevich": { s: "managed", i: "Calf", d: "Missed practice match, in line for Rd 1", mr: 0 },
  "Josh Dunkley":       { s: "managed", i: "Shoulder/ankle", d: "Full training, expected to play", mr: 0 },
  "Isaac Heeney":       { s: "managed", i: "Hamstring", d: "Workload managed, expected to play", mr: 0 },
  "Callum Mills":       { s: "managed", i: "Hamstring (pre-Xmas)", d: "Back in full training", mr: 0 },
  "Toby Nankervis":     { s: "managed", i: "General", d: "Building to Round 1", mr: 0 },
  "Clayton Oliver":     { s: "managed", i: "Calf strain", d: "Managed minutes", mr: 0 },
  "Christian Salem":    { s: "managed", i: "Running only", d: "No reported concerns", mr: 0 },
  "Jarrod Berry":       { s: "managed", i: "Shoulder (post-surgery)", d: "Full training", mr: 0 },
  "Jaspa Fletcher":     { s: "managed", i: "Shoulder (post-surgery)", d: "Full training", mr: 0 },
  "Mark Blicavs":       { s: "managed", i: "Ankle", d: "Minor injury", mr: 0 },
  "Sean Darcy":         { s: "managed", i: "Calf strain", d: "Round 1 target", mr: 0 },
  "Dan Houston":        { s: "managed", i: "Hip", d: "Likely available season start", mr: 0 },
  "Mitchell Hinge":     { s: "managed", i: "Back soreness", d: "Light duties", mr: 0 },
  "Tom Papley":         { s: "managed", i: "Calf", d: "Workload managed", mr: 0 },
  "Alex Pearce":        { s: "managed", i: "Stress-related", d: "Training loads managed", mr: 0 },
  "Isaac Quaynor":      { s: "managed", i: "Hamstring", d: "Likely available", mr: 0 },
  "Jy Farrar":          { s: "managed", i: "Knee knock", d: "1-2 weeks", mr: 0 },
  "Daniel McStay":      { s: "managed", i: "Shoulder", d: "Cleared, in line for Round 1", mr: 0 },
  "Sam Lalor":          { s: "managed", i: "Post-surgery", d: "Likely Round 1", mr: 0 },
  "Tom Lynch":          { s: "managed", i: "General", d: "Building to Round 1", mr: 0 },
  "Harry Sharp":        { s: "managed", i: "Hamstring", d: "Returned to match sim", mr: 0 },
  "Todd Marshall":      { s: "managed", i: "Achilles recovery", d: "Progressing well", mr: 0 },
  "Sullivan Robey":     { s: "managed", i: "Back stress", d: "Expected Round 1", mr: 0 },
  // Oscar Allen upgraded to AVAILABLE (expected Opening Round, SEN)
  "Keidean Coleman":    { s: "managed", i: "Quad (past)", d: "Expected to push Round 1 selection", mr: 0 },
  "James Sicily":       { s: "managed", i: "Shoulder/hip", d: "Recovered, in line for Community Series", mr: 0 },
  "Noah Answerth":      { s: "managed", i: "Achilles", d: "Returned to training, expected available", mr: 0 },
  "Lincoln McCarthy":   { s: "managed", i: "Knee recovery", d: "Full training, pushing for selection", mr: 0 },
  "Brady Hough":        { s: "managed", i: "Ankle", d: "Returned to full training", mr: 0 },
  "Tom Doedee":         { s: "managed", i: "Wrist/knee", d: "Available by season start", mr: 0 },
  "Bailey Smith":       { s: "managed", i: "Calf", d: "Expected fit for Opening Round", mr: 0 },
  "Shannon Neale":      { s: "managed", i: "Knee", d: "Cleared of serious injury scare", mr: 0 },
  // AVAILABLE — Recovered, no concern
  "Max Gawn":           { s: "available", i: "Finger fracture", d: "Played in Origin", mr: 0 },
  "Tom Stewart":        { s: "available", i: "Wrist cleanout", d: "Fit to play", mr: 0 },
  "Hayden Young":       { s: "available", i: "Multiple (2025)", d: "Returned to full fitness", mr: 0 },
  "Tom De Koning":      { s: "available", i: "Calf", d: "Overcome, available", mr: 0 },
  "Colby McKercher":    { s: "available", i: "Broken finger", d: "Surgery done, still expected Round 1", mr: 0 },
  "Toby Greene":        { s: "available", i: "Glute", d: "Cleared through Origin", mr: 0 },
  "Brayden Maynard":    { s: "available", i: "Quad", d: "Scans cleared", mr: 0 },
  "Jack Silvagni":      { s: "available", i: "Groin", d: "Overcome, available", mr: 0 },
  "Jack Ginnivan":      { s: "available", i: "Broken finger", d: "Fit for Opening Round", mr: 0 },
  "Luke McDonald":      { s: "available", i: "Wrist/AC joint", d: "Available (splint)", mr: 0 },
  "Charlie Curnow":     { s: "available", i: "Knee (past)", d: "Full pre-season", mr: 0 },
  "Blake Acres":        { s: "available", i: "Dislocated shoulder", d: "Available", mr: 0 },
  "Mitch Owens":        { s: "available", i: "Hamstring (past)", d: "Full pre-season", mr: 0 },
  "Logan McDonald":     { s: "available", i: "Ankle (past)", d: "Full training since November", mr: 0 },
  "Josh Gibcus":        { s: "available", i: "ACL (2024)", d: "Clean run, no issues", mr: 0 },
  "Dan Butler":         { s: "available", i: "Elbow (past)", d: "Full pre-season", mr: 0 },
  "Finn Maginness":     { s: "available", i: "Kidney (past)", d: "Full training", mr: 0 },
  "Dougal Howard":      { s: "available", i: "Hamstring (past)", d: "Clean pre-season", mr: 0 },
  "Darcy Parish":       { s: "available", i: "Various (2025)", d: "Trained to full capacity", mr: 0 },
  "Shai Bolton":        { s: "available", i: "Ankle (post-surgery)", d: "Recovered nicely", mr: 0 },
  "Nic Newman":         { s: "available", i: "Patella", d: "Set for Opening Round return", mr: 0 },
  "Oscar Allen":        { s: "available", i: "Knee (past)", d: "Expected Opening Round", mr: 0 },
};

function getInjuryInfo(playerName) {
  return INJURY_DATA[playerName] || null;
}

function getInjuryFactor(playerName) {
  const inj = INJURY_DATA[playerName];
  if (!inj || inj.mr === 0) return 1.0;
  return Math.max(0, (24 - inj.mr) / 24);
}

const INJ_STATUS_LABELS = {
  season: "OUT FOR SEASON",
  months: "OUT MONTHS",
  weeks: "OUT WEEKS",
  doubt: "ROUND 1 DOUBT",
  managed: "MANAGED",
  available: "RECOVERED",
};

/* =========================================================
   HELPERS
   ========================================================= */
function getPositions(player) {
  const p = player.p;
  if (p.includes('/')) {
    return p.split('/');
  }
  return [p];
}

function playerHasPosition(player, pos) {
  return getPositions(player).includes(pos);
}

function getPosClass(pos) {
  if (pos === 'DEF') return 'pos-def';
  if (pos === 'MID') return 'pos-mid';
  if (pos === 'RUC') return 'pos-ruc';
  if (pos === 'FWD') return 'pos-fwd';
  return '';
}

function getMyPickNumbers() {
  const { draftPos, numTeams, rounds } = state.config;
  const picks = [];
  for (let round = 0; round < rounds; round++) {
    let pick;
    if (round % 2 === 0) {
      // Forward: 1,2,...,N
      pick = round * numTeams + draftPos;
    } else {
      // Reverse: N,N-1,...,1
      pick = round * numTeams + (numTeams - draftPos + 1);
    }
    picks.push(pick);
  }
  return picks;
}

function isMyPick(pickNum) {
  return getMyPickNumbers().includes(pickNum);
}

function getNextMyPick() {
  const myPicks = getMyPickNumbers();
  return myPicks.find(p => p >= state.currentPick) || null;
}

function getPickGap() {
  const myPicks = getMyPickNumbers();
  const currentIdx = myPicks.findIndex(p => p >= state.currentPick);
  if (currentIdx < 0 || currentIdx >= myPicks.length - 1) return 0;
  return myPicks[currentIdx + 1] - myPicks[currentIdx];
}

function getPickTeam(pickNum) {
  const { numTeams } = state.config;
  const round = Math.ceil(pickNum / numTeams);
  const posInRound = pickNum - (round - 1) * numTeams;
  if (round % 2 === 1) {
    return posInRound;  // Forward round
  } else {
    return numTeams - posInRound + 1;  // Reverse round
  }
}

function getAvailable() {
  return PLAYER_DATA.filter(p => !state.draftedNames.has(p.n) && !state.removedNames.has(p.n));
}

function getRosterNeeds() {
  const { roster, benchTotal } = state.config;
  const needs = {};
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    needs[pos] = Math.max(0, roster[pos] - state.myTeam[pos].length);
  }
  needs._startersLeft = Object.values(needs).reduce((s, v) => s + v, 0);
  needs._benchLeft = Math.max(0, benchTotal - state.myBench.length);
  needs._totalLeft = needs._startersLeft + needs._benchLeft;
  return needs;
}

function getMyTotalPicks() {
  let total = state.myBench.length;
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    total += state.myTeam[pos].length;
  }
  return total;
}

/* =========================================================
   LEAGUE CHARTS — All-Team Rosters & Canvas Drawing
   ========================================================= */
function buildAllTeamRosters(picksSubset) {
  const { numTeams, roster, benchTotal } = state.config;
  const totalPerTeam = Object.values(roster).reduce((s, v) => s + v, 0) + benchTotal;
  const teams = {};
  for (let t = 1; t <= numTeams; t++) {
    teams[t] = { DEF: [], MID: [], RUC: [], FWD: [] };
  }
  for (const pick of picksSubset) {
    const teamNum = getPickTeam(pick.pickNum);
    if (pick.isMyPick && pick.pickPos) {
      teams[teamNum][pick.pickPos].push(pick.player);
    } else {
      // Opponent pick: assign to position with most remaining starter need, then any
      const positions = getPositions(pick.player);
      let bestPos = positions[0];
      let bestNeed = -1;
      for (const pos of positions) {
        const starterNeed = roster[pos] - teams[teamNum][pos].length;
        if (starterNeed > bestNeed) { bestNeed = starterNeed; bestPos = pos; }
      }
      teams[teamNum][bestPos].push(pick.player);
    }
  }
  return teams;
}

function calcTeamSeasonEV(teamRoster) {
  const { roster } = state.config;
  let totalEV = 0;
  const WEEKS = 24;
  const BENCH_FACTOR = 0.50;
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    const players = [...teamRoster[pos]];
    // Sort by EV descending
    players.sort((a, b) => {
      const evA = getBlendedAvg(a) * (1 - getWeeklyMissRate(a));
      const evB = getBlendedAvg(b) * (1 - getWeeklyMissRate(b));
      return evB - evA;
    });
    const starterCount = roster[pos];
    for (let i = 0; i < players.length; i++) {
      const ev = getBlendedAvg(players[i]) * (1 - getWeeklyMissRate(players[i]));
      if (i < starterCount) {
        totalEV += ev * WEEKS;
      } else {
        totalEV += ev * WEEKS * BENCH_FACTOR;
      }
    }
  }
  return totalEV;
}

function getTeamNames() {
  const { numTeams, draftPos } = state.config;
  const names = {};
  for (let t = 1; t <= numTeams; t++) {
    if (t === draftPos) { names[t] = 'You'; continue; }
    // Find first player drafted by this team
    const firstPick = state.picks.find(p => getPickTeam(p.pickNum) === t);
    if (firstPick) {
      // Use surname only (last word of name) to keep labels short
      const parts = firstPick.player.n.split(' ');
      names[t] = parts[parts.length - 1];
    } else {
      names[t] = 'T' + t;
    }
  }
  return names;
}

// 18 distinct colours: gold for user, muted hues for opponents
const TEAM_COLOURS = [
  '#e06060', // muted red
  '#e08a50', // muted orange
  '#d4b040', // muted amber
  '#80c050', // muted lime
  '#50b868', // muted green
  '#40b8a0', // muted teal
  '#50a8c8', // muted cyan
  '#6090d0', // muted blue
  '#7878d8', // muted indigo
  '#9868c8', // muted purple
  '#b860b0', // muted magenta
  '#d060a0', // muted pink
  '#c87878', // muted coral
  '#a09060', // muted khaki
  '#70a878', // muted sage
  '#6898a8', // muted slate
  '#9080b0', // muted lavender
];

function getLeagueEVData() {
  const { numTeams, rounds } = state.config;
  const totalPicks = state.picks.length;
  const teamLines = {};
  for (let t = 1; t <= numTeams; t++) teamLines[t] = [];

  // Build data point at end of each round + current partial round
  const roundEnds = [];
  for (let r = 1; r <= rounds; r++) {
    const endPick = r * numTeams;
    if (endPick <= totalPicks) {
      roundEnds.push({ label: 'R' + r, pickCount: endPick });
    }
  }
  // Add current state as latest point if we're mid-round
  const lastCompleteRound = Math.floor(totalPicks / numTeams);
  if (totalPicks > lastCompleteRound * numTeams || totalPicks === 0) {
    const currentRound = lastCompleteRound + 1;
    if (totalPicks > 0) {
      roundEnds.push({ label: 'R' + currentRound + '*', pickCount: totalPicks });
    }
  }

  let maxEV = 0;
  for (const point of roundEnds) {
    const subset = state.picks.slice(0, point.pickCount);
    const rosters = buildAllTeamRosters(subset);
    for (let t = 1; t <= numTeams; t++) {
      const ev = calcTeamSeasonEV(rosters[t]);
      teamLines[t].push(ev);
      if (ev > maxEV) maxEV = ev;
    }
  }

  return {
    teamLines,
    labels: roundEnds.map(r => r.label),
    maxEV,
    myTeamNum: state.config.draftPos,
    numPoints: roundEnds.length,
  };
}

function getSupplyData() {
  const { numTeams, rounds } = state.config;
  const totalPicks = state.picks.length;
  const thresholds = state.qualityThresholds || state.replacementLevels || {};

  const posLines = { DEF: [], MID: [], RUC: [], FWD: [] };
  const labels = ['Start'];

  // Initial supply (before any picks)
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    const quality = PLAYER_DATA.filter(p =>
      playerHasPosition(p, pos) && p.a >= (thresholds[pos] || 0) &&
      !(p.rk && p.rk.some(r => r.s === 'out'))
    );
    posLines[pos].push(quality.length);
  }

  // After each round + current partial round
  const roundEnds = [];
  for (let r = 1; r <= rounds; r++) {
    const endPick = r * numTeams;
    if (endPick <= totalPicks) {
      roundEnds.push({ label: 'R' + r, pickCount: endPick });
    }
  }
  const lastCompleteRound = Math.floor(totalPicks / numTeams);
  if (totalPicks > lastCompleteRound * numTeams) {
    roundEnds.push({ label: 'R' + (lastCompleteRound + 1) + '*', pickCount: totalPicks });
  }

  for (const point of roundEnds) {
    labels.push(point.label);
    const draftedSet = new Set(state.picks.slice(0, point.pickCount).map(p => p.player.n));
    for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
      const quality = PLAYER_DATA.filter(p =>
        playerHasPosition(p, pos) && p.a >= (thresholds[pos] || 0) &&
        !draftedSet.has(p.n) &&
        !(p.rk && p.rk.some(r => r.s === 'out'))
      );
      posLines[pos].push(quality.length);
    }
  }

  return { posLines, labels };
}

function drawLineChart(canvas, config) {
  const {
    lines,        // [{ data: [...], color, width, opacity, label }]
    labels,       // x-axis labels
    yFormat,      // function(val) => string
    height,       // canvas CSS height
    showLegend,   // { items: [{ color, label }], position: 'top-right' }
    highlightLast // { lineIndex, color } — draw dot + value at last point
  } = config;

  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.parentElement.getBoundingClientRect();
  const cssW = rect.width - 24; // account for padding
  const cssH = height;
  canvas.style.width = cssW + 'px';
  canvas.style.height = cssH + 'px';
  canvas.width = cssW * dpr;
  canvas.height = cssH * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);

  const margin = { top: 12, right: config.rightMargin || 60, bottom: 28, left: 50 };
  const w = cssW - margin.left - margin.right;
  const h = cssH - margin.top - margin.bottom;

  // Clear
  ctx.clearRect(0, 0, cssW, cssH);

  // Find y range
  let yMin = Infinity, yMax = -Infinity;
  for (const line of lines) {
    for (const v of line.data) {
      if (v < yMin) yMin = v;
      if (v > yMax) yMax = v;
    }
  }
  if (yMin === Infinity) { yMin = 0; yMax = 100; }
  if (yMax === yMin) { yMax = yMin + 100; }
  // Add 10% padding
  const yRange = yMax - yMin;
  yMin = Math.max(0, yMin - yRange * 0.1);
  yMax = yMax + yRange * 0.1;

  const numPoints = labels.length;
  const xStep = numPoints > 1 ? w / (numPoints - 1) : w;

  function toX(i) { return margin.left + i * xStep; }
  function toY(v) { return margin.top + h - ((v - yMin) / (yMax - yMin)) * h; }

  // Grid lines
  const yTicks = 5;
  ctx.strokeStyle = 'rgba(255,255,255,0.06)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= yTicks; i++) {
    const val = yMin + (yMax - yMin) * (i / yTicks);
    const y = toY(val);
    ctx.beginPath();
    ctx.moveTo(margin.left, y);
    ctx.lineTo(margin.left + w, y);
    ctx.stroke();

    // Y-axis labels
    ctx.fillStyle = 'rgba(255,255,255,0.35)';
    ctx.font = '10px -apple-system, system-ui, sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText(yFormat ? yFormat(val) : Math.round(val).toString(), margin.left - 6, y + 3);
  }

  // X-axis labels
  ctx.fillStyle = 'rgba(255,255,255,0.35)';
  ctx.font = '10px -apple-system, system-ui, sans-serif';
  ctx.textAlign = 'center';
  // Show every label if <= 18, else skip some
  const labelSkip = numPoints > 18 ? Math.ceil(numPoints / 16) : 1;
  for (let i = 0; i < numPoints; i++) {
    if (i % labelSkip === 0 || i === numPoints - 1) {
      ctx.fillText(labels[i], toX(i), cssH - 4);
    }
  }

  // Draw lines (non-highlighted first, highlighted last so it's on top)
  const drawOrder = lines.map((l, i) => i);
  if (config.highlightLast) {
    const hlIdx = config.highlightLast.lineIndex;
    const idx = drawOrder.indexOf(hlIdx);
    if (idx >= 0) { drawOrder.splice(idx, 1); drawOrder.push(hlIdx); }
  }

  for (const li of drawOrder) {
    const line = lines[li];
    if (line.data.length < 1) continue;
    ctx.strokeStyle = line.color;
    ctx.lineWidth = line.width || 1;
    ctx.globalAlpha = line.opacity !== undefined ? line.opacity : 1;
    ctx.beginPath();
    ctx.moveTo(toX(0), toY(line.data[0]));
    for (let i = 1; i < line.data.length; i++) {
      ctx.lineTo(toX(i), toY(line.data[i]));
    }
    ctx.stroke();
    ctx.globalAlpha = 1;
  }

  // Ranked sidebar legend (stacked by EV, highest first)
  if (config.rankedLegend) {
    const ranked = lines
      .map((line, i) => {
        if (!line.data.length || !line.label) return null;
        const lastVal = line.data[line.data.length - 1];
        return { line, val: lastVal };
      })
      .filter(Boolean)
      .sort((a, b) => b.val - a.val); // highest EV first

    const legendX = margin.left + w + 12;
    const ROW_H = Math.min(18, (h - 4) / ranked.length);
    let legendY = margin.top + 4;

    for (let r = 0; r < ranked.length; r++) {
      const { line, val } = ranked[r];
      const isMe = line.highlight;
      const rank = r + 1;

      // Colour bar
      ctx.fillStyle = line.color;
      ctx.globalAlpha = isMe ? 1 : 0.7;
      ctx.fillRect(legendX, legendY, 10, ROW_H - 4);

      // Rank number
      ctx.fillStyle = isMe ? '#ffd700' : 'rgba(255,255,255,0.4)';
      ctx.globalAlpha = isMe ? 1 : 0.6;
      ctx.font = isMe
        ? 'bold 10px -apple-system, system-ui, sans-serif'
        : '9px -apple-system, system-ui, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText(rank + '.', legendX + 14, legendY + ROW_H - 7);

      // Name
      ctx.fillStyle = isMe ? '#ffd700' : 'rgba(255,255,255,0.55)';
      ctx.fillText(line.label, legendX + 28, legendY + ROW_H - 7);

      // EV value (right-aligned)
      const valStr = yFormat ? yFormat(val) : Math.round(val).toString();
      ctx.textAlign = 'right';
      ctx.fillText(valStr, cssW - 4, legendY + ROW_H - 7);

      ctx.globalAlpha = 1;
      legendY += ROW_H;
    }
  }

  // Highlight dot + value on user's team
  if (config.highlightLast && !config.rankedLegend) {
    const hl = config.highlightLast;
    const line = lines[hl.lineIndex];
    if (line && line.data.length > 0) {
      const lastIdx = line.data.length - 1;
      const x = toX(lastIdx);
      const y = toY(line.data[lastIdx]);

      // Dot
      ctx.beginPath();
      ctx.arc(x, y, 4, 0, Math.PI * 2);
      ctx.fillStyle = hl.color;
      ctx.fill();

      // Value label
      ctx.fillStyle = hl.color;
      ctx.font = 'bold 11px -apple-system, system-ui, sans-serif';
      ctx.textAlign = 'left';
      const valStr = yFormat ? yFormat(line.data[lastIdx]) : Math.round(line.data[lastIdx]).toString();
      ctx.fillText(valStr, x + 8, y + 4);
    }
  }

  // Legend
  if (showLegend && showLegend.items) {
    const legendX = margin.left + w - 10;
    let legendY = margin.top + 8;
    ctx.textAlign = 'right';
    ctx.font = '10px -apple-system, system-ui, sans-serif';
    for (const item of showLegend.items) {
      ctx.fillStyle = item.color;
      ctx.fillRect(legendX + 4, legendY - 6, 12, 8);
      ctx.fillStyle = 'rgba(255,255,255,0.6)';
      ctx.fillText(item.label, legendX, legendY);
      legendY += 14;
    }
  }
}

function renderLeagueCharts() {
  if (state.picks.length === 0 && state.phase === 'config') return;

  // EV Projection Chart
  const evData = getLeagueEVData();
  const evCanvas = document.getElementById('ev-chart');
  if (!evCanvas) return;

  const evLines = [];
  const myTeamNum = evData.myTeamNum;
  const teamNames = getTeamNames();
  let colourIdx = 0;
  for (let t = 1; t <= state.config.numTeams; t++) {
    const isMe = t === myTeamNum;
    const colour = isMe ? '#ffd700' : TEAM_COLOURS[colourIdx++ % TEAM_COLOURS.length];
    evLines.push({
      data: evData.teamLines[t] || [],
      color: colour,
      width: isMe ? 2.5 : 1.2,
      opacity: isMe ? 1 : 0.55,
      label: teamNames[t],
      highlight: isMe,
    });
  }

  drawLineChart(evCanvas, {
    lines: evLines,
    labels: evData.labels.length > 0 ? evData.labels : ['Start'],
    yFormat: v => {
      if (v >= 1000) return (v / 1000).toFixed(1) + 'k';
      return Math.round(v).toString();
    },
    height: 400,
    rankedLegend: true,
    rightMargin: 140,
  });

  // Supply Curve Chart
  const supplyData = getSupplyData();
  const supplyCanvas = document.getElementById('supply-chart');
  if (!supplyCanvas) return;

  const posColors = { DEF: '#4a9eff', MID: '#4aff9e', RUC: '#ffaa4a', FWD: '#ff4a6a' };
  const supplyLines = [];
  const legendItems = [];
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    const data = supplyData.posLines[pos];
    const currentCount = data.length > 0 ? data[data.length - 1] : 0;
    supplyLines.push({
      data,
      color: posColors[pos],
      width: 2,
      opacity: 1,
    });
    legendItems.push({ color: posColors[pos], label: `${pos}: ${currentCount}` });
  }

  drawLineChart(supplyCanvas, {
    lines: supplyLines,
    labels: supplyData.labels,
    yFormat: v => Math.round(v).toString(),
    height: 250,
    showLegend: { items: legendItems },
  });
}

/* =========================================================
   PSSV & SCORING ENGINE
   ========================================================= */
function calculateReplacementLevels(available) {
  const { numTeams, roster, benchTotal } = state.config;
  const levels = {};
  const scarcity = {};
  const benchPerPos = benchTotal / 4;  // Estimate bench demand spread evenly
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    const posPlayers = available.filter(p => playerHasPosition(p, pos));
    posPlayers.sort((a, b) => b.a - a.a);
    // Total demand: starters + estimated bench share
    const totalDemand = numTeams * (roster[pos] + benchPerPos);
    const supply = posPlayers.length;
    scarcity[pos] = supply / totalDemand;
    const replIdx = Math.min(Math.round(totalDemand), supply - 1);
    levels[pos] = replIdx >= 0 ? (posPlayers[replIdx]?.a || 0) : 0;
  }
  state.replacementLevels = levels;
  state.scarcity = scarcity;
  return levels;
}

function calculateTiers(available) {
  const tiers = {};
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    const posPlayers = available.filter(p => playerHasPosition(p, pos));
    posPlayers.sort((a, b) => b.a - a.a);

    if (posPlayers.length < 3) {
      tiers[pos] = {};
      posPlayers.forEach((p, i) => { tiers[pos][p.n] = 1; });
      continue;
    }

    // Calculate gaps
    const gaps = [];
    for (let i = 0; i < posPlayers.length - 1; i++) {
      gaps.push({ index: i, gap: posPlayers[i].a - posPlayers[i + 1].a });
    }

    // Find natural break points (top 4 largest gaps)
    const sorted = [...gaps].sort((a, b) => b.gap - a.gap);
    const minGap = pos === 'RUC' ? 2 : 3; // Lower threshold for rucks (fewer players)
    const breaks = sorted
      .filter(g => g.gap >= minGap)
      .slice(0, 5)
      .map(g => g.index)
      .sort((a, b) => a - b);

    tiers[pos] = {};
    let tier = 1;
    for (let i = 0; i < posPlayers.length; i++) {
      tiers[pos][posPlayers[i].n] = tier;
      if (breaks.includes(i)) tier++;
    }
  }
  state.tiers = tiers;
  return tiers;
}

function getPlayerTier(player) {
  const positions = getPositions(player);
  let bestTier = 99;
  for (const pos of positions) {
    const t = state.tiers[pos]?.[player.n];
    if (t && t < bestTier) bestTier = t;
  }
  return bestTier === 99 ? 6 : bestTier;
}

function getTierLabel(tier) {
  if (tier === 1) return 'Elite';
  if (tier === 2) return 'Premium';
  if (tier === 3) return 'Solid';
  if (tier === 4) return 'Role Player';
  return 'Depth';
}

function getConsistencyScore(player) {
  if (!player.g || player.g < 3) return 0;
  const rate100 = player.s1 / player.g;
  return rate100; // 0 to 1
}

function getDurabilityScore(player) {
  if (player.g >= 22) return 1;
  if (player.g >= 17) return 0.7;
  if (player.g >= 12) return 0.4;
  return 0.1;
}

// Volatile Blend: if a player's avg jumped/dropped >15 pts between seasons,
// blend 60% recent + 40% prior to catch regression-to-mean.
// Cross-validated: +459 on 2024, +511 on 2025 (both p<0.001).
function getBlendedAvg(player) {
  const a25 = player.a;
  const a24 = player.a24;
  if (a25 > 0 && a24 != null && a24 > 0) {
    const spread = Math.abs(a25 - a24);
    if (spread > 15) return 0.6 * a25 + 0.4 * a24;
  }
  return a25;
}

function isVolatileBlended(player) {
  const a24 = player.a24;
  return a24 != null && a24 > 0 && Math.abs(player.a - a24) > 15;
}

function getWeeklyMissRate(player) {
  let baseRate;
  if (player.g >= 22) baseRate = 0.05;
  else if (player.g >= 17) baseRate = 0.15;
  else if (player.g >= 12) baseRate = 0.30;
  else baseRate = 0.45;
  if (player.rk && player.rk.some(r => r.s === 'out')) return 1.0;
  // No Hugo adjustment — games played already captures injury risk
  return baseRate;
}

function getTrendData(player) {
  const seasons = [];
  if (player.a23 && player.a23 > 0) seasons.push({ yr: '23', avg: player.a23 });
  if (player.a24 && player.a24 > 0) seasons.push({ yr: '24', avg: player.a24 });
  seasons.push({ yr: '25', avg: player.a });
  if (seasons.length < 2) return { trend: 'none', seasons, spread: 0 };
  const last = seasons[seasons.length - 1].avg;
  const prev = seasons[seasons.length - 2].avg;
  const diff = last - prev;
  const trend = diff > 5 ? 'up' : diff < -5 ? 'down' : 'stable';
  const avgs = seasons.map(s => s.avg);
  const spread = Math.max(...avgs) - Math.min(...avgs);
  return { trend, seasons, spread };
}

function getRecommendations() {
  const available = getAvailable();
  const levels = calculateReplacementLevels(available);
  calculateTiers(available);
  const needs = getRosterNeeds();
  const totalNeeds = Object.values(needs).reduce((s, v) => s + v, 0);

  const totalSlots = Object.values(state.config.roster).reduce((s, v) => s + v, 0)
    + state.config.benchTotal;

  // Pick gap for PSSV calculation (display only)
  const gap = getPickGap() || 1;

  // Demand share per position (bench spread evenly for estimation)
  const starterSlots = Object.values(state.config.roster).reduce((s, v) => s + v, 0);
  const benchPerPos = state.config.benchTotal / 4;
  const demandShare = {};
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    demandShare[pos] = (state.config.roster[pos] + benchPerPos) / totalSlots;
  }

  // Available players per position (sorted by avg, excluding out-for-season)
  const availByPos = {};
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    availByPos[pos] = available
      .filter(p => playerHasPosition(p, pos) && !(p.rk && p.rk.some(r => r.s === 'out')))
      .sort((a, b) => b.a - a.a);
  }

  // PSSV per position (display only — not used in scoring)
  const positionalPSSV = {};
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    const avail = availByPos[pos];
    if (avail.length <= 1) { positionalPSSV[pos] = 0; continue; }
    const bestNow = avail[0].a;
    const expectedTaken = Math.max(1, Math.round(gap * demandShare[pos]));
    const bestAfterIdx = Math.min(expectedTaken, avail.length - 1);
    const bestAfter = avail[bestAfterIdx].a;
    positionalPSSV[pos] = Math.max(0, bestNow - bestAfter);
  }
  state.positionalPSSV = positionalPSSV;

  // === TIER CLIFF DETECTION ===
  // Detect positions where the last elite/premium player is about to disappear
  const tierCliffBonus = { DEF: 0, MID: 0, RUC: 0, FWD: 0 };
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    if (needs[pos] <= 0) continue;
    const posAvail = availByPos[pos];
    if (posAvail.length < 2) continue;

    // Find tier 1 and tier 2 players at this position
    const tier1 = posAvail.filter(p => (state.tiers[pos]?.[p.n] || 99) === 1);
    const tier2 = posAvail.filter(p => (state.tiers[pos]?.[p.n] || 99) === 2);

    if (tier1.length > 0 && tier1.length <= 2) {
      // Last 1-2 elite players — calculate cliff size
      const lastEliteAvg = tier1[tier1.length - 1].a;
      const nextTierAvg = tier2.length > 0 ? tier2[0].a :
        posAvail.find(p => (state.tiers[pos]?.[p.n] || 99) > 1)?.a || 0;
      const cliffSize = lastEliteAvg - nextTierAvg;
      if (cliffSize >= 3) {
        tierCliffBonus[pos] = tier1.length === 1 ? Math.min(6, cliffSize * 0.4) : Math.min(4, cliffSize * 0.3);
      }
    } else if (tier1.length === 0 && tier2.length > 0 && tier2.length <= 2) {
      // No elites left, last 1-2 premium players
      const lastPremAvg = tier2[tier2.length - 1].a;
      const nextTierAvg = posAvail.find(p => (state.tiers[pos]?.[p.n] || 99) > 2)?.a || 0;
      const cliffSize = lastPremAvg - nextTierAvg;
      if (cliffSize >= 3) {
        tierCliffBonus[pos] = tier2.length === 1 ? Math.min(4, cliffSize * 0.3) : Math.min(2, cliffSize * 0.2);
      }
    }
  }
  state.tierCliffBonus = tierCliffBonus;

  // === SCORE EACH PLAYER: SMART NAIVE ===
  const scored = available.map(player => {
    const positions = getPositions(player);
    const isOutForSeason = player.rk && player.rk.some(r => r.s === 'out');

    // VORP for display only
    let bestVORP = -Infinity;
    let bestPos = positions[0];
    for (const pos of positions) {
      const rawV = player.a - (levels[pos] || 0);
      if (rawV > bestVORP) { bestVORP = rawV; bestPos = pos; }
    }

    // Quality metrics for UI display
    const consistency = getConsistencyScore(player);
    const durability = getDurabilityScore(player);
    const missRate = getWeeklyMissRate(player);
    const trendData = getTrendData(player);
    const blendedAvg = getBlendedAvg(player);
    const evScore = blendedAvg * (1 - missRate);

    // PSSV for display only
    let bestPSSV = -1;
    for (const pos of positions) {
      if (needs[pos] > 0 && positionalPSSV[pos] > bestPSSV) {
        bestPSSV = positionalPSSV[pos];
      }
    }
    if (bestPSSV < 0) bestPSSV = 0;

    // ========================================
    // EV SCORING (with Volatile Blend)
    // Score = blendedAvg × (1 - missRate)
    // Volatile Blend: if |a25-a24| > 15, use 0.6*a25 + 0.4*a24
    // Shifted thresholds (g>=22/17/12), no Hugo adjustment
    // Cross-validated: +459 on 2024, +511 on 2025 (both p<0.001)
    // ========================================

    // 1. EV SCORE: blended average adjusted for availability
    let evMissRate;
    if (player.g >= 22) evMissRate = 0.05;
    else if (player.g >= 17) evMissRate = 0.15;
    else if (player.g >= 12) evMissRate = 0.30;
    else evMissRate = 0.45;
    if (isOutForSeason) evMissRate = 1.0;

    let score = blendedAvg * (1 - evMissRate);

    // Apply 2026 preseason injury factor (reduces EV proportional to missed rounds)
    const injInfo = getInjuryInfo(player.n);
    const injFactor = getInjuryFactor(player.n);
    if (injInfo && injInfo.s === 'season') {
      score = -9999; // Do not draft
    } else if (injFactor < 1.0) {
      score *= injFactor;
    }

    // Still compute penalties/bonuses for DISPLAY ONLY (badges, info)
    const isFragile = player.a >= 90 && player.g < 15 && !isOutForSeason;
    let fragilePenalty = 0;
    if (isFragile) {
      fragilePenalty = (15 - player.g) * 0.7;
    }

    let hugoRiskPenalty = 0;
    if (player.hr === 'High') { hugoRiskPenalty = 4; }
    else if (player.hr === 'Medium') { hugoRiskPenalty = 1.5; }

    let trendBonus = 0;
    if (trendData.seasons.length >= 2) {
      if (trendData.trend === 'up') { trendBonus = 2; }
      else if (trendData.trend === 'down') { trendBonus = -2; }
    }

    let cliffBonus = 0;
    for (const pos of positions) {
      if (needs[pos] > 0 && tierCliffBonus[pos] > 0) {
        const playerTierAtPos = state.tiers[pos]?.[player.n] || 99;
        const isAtCliff = (tierCliffBonus[pos] > 3 && playerTierAtPos === 1) ||
                          (tierCliffBonus[pos] <= 3 && playerTierAtPos <= 2);
        if (isAtCliff && tierCliffBonus[pos] > cliffBonus) {
          cliffBonus = tierCliffBonus[pos];
        }
      }
    }

    // HARD CONSTRAINTS
    if (isOutForSeason) score -= 9999;
    const canFillStarter = positions.some(pos => needs[pos] > 0);
    const canFillBench = needs._benchLeft > 0;
    // Penalise if this player can't fill any starter need AND starters still needed
    if (!canFillStarter && needs._startersLeft > 0) score -= 9999;
    // If all starters filled, anyone can fill bench — no penalty needed

    // Determine fill position: prefer position with highest need
    let fillPos = positions[0];
    let bestFillNeed = -1;
    for (const pos of positions) {
      if (needs[pos] > 0 && needs[pos] > bestFillNeed) {
        fillPos = pos;
        bestFillNeed = needs[pos];
      }
    }

    // Find durable swap suggestion for fragile players
    let fragileSwap = null;
    if (isFragile) {
      const durableAlt = available
        .filter(d => d.g >= 22 && d.a >= evScore - 5 && d.n !== player.n &&
          positions.some(pos => playerHasPosition(d, pos)))
        .sort((a, b) => b.a - a.a)[0];
      if (durableAlt) {
        fragileSwap = `${durableAlt.n} (${durableAlt.a} avg, ${durableAlt.g}gm)`;
      }
    }

    return {
      ...player,
      vorp: bestVORP,
      pssv: bestPSSV,
      evScore,
      blendedAvg,
      isBlended: isVolatileBlended(player),
      adjustedScore: score,
      bestPos,
      fillPos,
      positions,
      tier: getPlayerTier(player),
      consistency,
      durability,
      missRate,
      trendData,
      isFragile,
      fragileSwap,
      fragilePenalty,
      trendBonus,
      cliffBonus,
      hugoRiskPenalty,
      injInfo,
      injFactor,
    };
  });

  state.lateDraftMode = false;
  scored.sort((a, b) => b.adjustedScore - a.adjustedScore);
  return scored;
}

/* =========================================================
   ALERTS
   ========================================================= */
function getAlerts() {
  const alerts = [];
  const available = getAvailable();
  const needs = getRosterNeeds();
  const isMyTurn = isMyPick(state.currentPick);

  // My turn alert
  if (isMyTurn) {
    alerts.push({ type: 'myturn', text: "It's YOUR pick! Choose wisely." });
  }

  // Cliff alerts - last player(s) in a tier at a needed position
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    if (needs[pos] <= 0) continue;
    const posAvail = available.filter(p => playerHasPosition(p, pos));
    posAvail.sort((a, b) => b.a - a.a);

    // Check top tiers (only for players with meaningful averages)
    const minAvgForAlert = pos === 'RUC' ? 60 : 75;
    for (let tierNum = 1; tierNum <= 2; tierNum++) {
      const inTier = posAvail.filter(p =>
        (state.tiers[pos]?.[p.n] || 99) === tierNum && p.a >= minAvgForAlert
      );
      if (inTier.length === 0) continue;
      if (inTier.length === 1) {
        const label = tierNum === 1 ? 'Elite' : 'Premium';
        alerts.push({
          type: 'cliff',
          text: `Last ${label} ${pos}: ${inTier[0].n} (${inTier[0].a} avg)`
        });
      } else if (inTier.length === 2) {
        const label = tierNum === 1 ? 'Elite' : 'Premium';
        alerts.push({
          type: 'cliff',
          text: `Only 2 ${label} ${pos}s left: ${inTier[0].n}, ${inTier[1].n}`
        });
      }
    }
  }

  // Run detection - last 5 picks same position
  if (state.picks.length >= 3) {
    const last5 = state.picks.slice(-5);
    const posCounts = {};
    last5.forEach(pick => {
      getPositions(pick.player).forEach(pos => {
        posCounts[pos] = (posCounts[pos] || 0) + 1;
      });
    });
    for (const [pos, count] of Object.entries(posCounts)) {
      if (count >= 3) {
        alerts.push({
          type: 'run',
          text: `Run on ${pos}: ${count} of last ${last5.length} picks were ${pos}s`
        });
      }
    }
  }

  // Position need warnings
  const urgentNeeds = [];
  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    if (needs[pos] > 0) {
      const posAvail = available.filter(p => playerHasPosition(p, pos));
      const aboveRepl = posAvail.filter(p => p.a > (state.replacementLevels[pos] || 0));
      if (aboveRepl.length <= needs[pos] + 2) {
        urgentNeeds.push(`${pos} (${needs[pos]} needed, ${aboveRepl.length} decent left)`);
      }
    }
  }
  if (urgentNeeds.length > 0) {
    alerts.push({ type: 'need', text: `Position crunch: ${urgentNeeds.join(', ')}` });
  }

  return alerts;
}

/* =========================================================
   DRAFT ACTIONS
   ========================================================= */
function draftPlayer(playerName, isMyPick) {
  const player = PLAYER_DATA.find(p => p.n === playerName);
  if (!player || state.draftedNames.has(playerName)) return;

  state.draftedNames.add(playerName);
  const pickNum = state.currentPick;

  // Determine position for my team
  // Priority: fill starter slots first (prefer position with highest need), then bench
  let pickPos = null;
  let isBenchPick = false;
  if (isMyPick) {
    const positions = getPositions(player);
    const needs = getRosterNeeds();
    pickPos = positions[0];
    let maxNeed = -1;
    for (const pos of positions) {
      if (needs[pos] > 0 && needs[pos] > maxNeed) {
        maxNeed = needs[pos];
        pickPos = pos;
      }
    }
    if (maxNeed > 0) {
      // Filling a starter slot
      state.myTeam[pickPos].push(player);
    } else if (needs._benchLeft > 0) {
      // All starter slots filled for this player's positions — goes to bench
      isBenchPick = true;
      state.myBench.push({ ...player, benchPos: pickPos });
    } else {
      // Overflow — shouldn't happen but handle gracefully
      state.myTeam[pickPos].push(player);
    }
  }

  state.picks.push({ player, pickNum, isMyPick, pickPos, isBenchPick });
  state.currentPick++;
  render();
}

function undoPick() {
  if (state.picks.length === 0) return;
  const last = state.picks.pop();
  state.draftedNames.delete(last.player.n);
  state.currentPick--;

  if (last.isMyPick) {
    if (last.isBenchPick) {
      const idx = state.myBench.findIndex(p => p.n === last.player.n);
      if (idx >= 0) state.myBench.splice(idx, 1);
    } else if (last.pickPos) {
      const arr = state.myTeam[last.pickPos];
      const idx = arr.findIndex(p => p.n === last.player.n);
      if (idx >= 0) arr.splice(idx, 1);
    }
  }
  render();
}

function skipPick() {
  const pickNum = state.currentPick;
  state.picks.push({ player: { n: '(Unknown player)', p: '?', a: 0, g: 0 }, pickNum, isMyPick: false, pickPos: null, isBenchPick: false, isSkipped: true });
  state.currentPick++;
  render();
}

function removePlayer(playerName) {
  state.removedNames.add(playerName);
  render();
}

function undoRemoveAll() {
  state.removedNames.clear();
  render();
}

function undoRemoveLast() {
  const arr = Array.from(state.removedNames);
  if (arr.length === 0) return;
  state.removedNames.delete(arr[arr.length - 1]);
  render();
}

function showDraftModal(playerName, asMyPick) {
  const player = PLAYER_DATA.find(p => p.n === playerName);
  if (!player) return;

  const modal = document.getElementById('modal');
  const title = document.getElementById('modal-title');
  const text = document.getElementById('modal-text');
  const btn = document.getElementById('modal-confirm');

  if (asMyPick) {
    title.textContent = 'Draft to Your Team?';
    text.innerHTML = `<strong>${player.n}</strong> (${player.p}) — ${player.a} avg`;
    if (player.rk) {
      const warnings = player.rk.map(r => {
        if (r.s === 'out') return `<span style="color:#ff6b6b;font-weight:700;">⚠ ${r.l}</span>`;
        if (r.s === 'high') return `<span style="color:var(--ruc);font-weight:600;">⚠ ${r.l}</span>`;
        if (r.s === 'med') return `<span style="color:var(--yellow);">⚠ ${r.l}</span>`;
        return `<span style="color:var(--def);">ℹ ${r.l}</span>`;
      });
      text.innerHTML += '<br>' + warnings.join('<br>');
    }
    btn.textContent = 'Draft!';
    btn.className = 'modal-confirm';
  } else {
    title.textContent = 'Mark as Drafted?';
    text.innerHTML = `<strong>${player.n}</strong> drafted by another team`;
    btn.textContent = 'Mark Drafted';
    btn.className = 'modal-confirm draft-other';
  }

  state.modalCallback = () => draftPlayer(playerName, asMyPick);
  modal.classList.add('show');
}

function confirmModal() {
  if (state.modalCallback) state.modalCallback();
  closeModal();
}

function closeModal() {
  document.getElementById('modal').classList.remove('show');
  state.modalCallback = null;
}

/* =========================================================
   RENDERING
   ========================================================= */
function render() {
  renderPickBar();
  renderAlerts();
  renderRecs();
  renderPlayers();
  renderMyTeam();
  renderLog();
  updateTabBadges();
  if (state.activeTab === 'league') renderLeagueCharts();
}

function renderPickBar() {
  const myTurn = isMyPick(state.currentPick);
  const label = document.getElementById('pick-label');
  const team = getPickTeam(state.currentPick);
  label.textContent = myTurn ? `Pick #${state.currentPick} — YOUR TURN` : `Pick #${state.currentPick} — Team ${team}`;
  label.className = 'pick-num' + (myTurn ? ' my-turn' : '');

  const nextPick = getNextMyPick();
  const nextLabel = document.getElementById('next-pick-label');
  if (nextPick && nextPick > state.currentPick) {
    const gap = nextPick - state.currentPick;
    nextLabel.textContent = `Your next: Pick #${nextPick} (${gap} away) | Gap after: ${getPickGap()}`;
  } else if (nextPick === state.currentPick) {
    nextLabel.textContent = `This is your pick! | Gap after: ${getPickGap()}`;
  } else {
    nextLabel.textContent = 'No more picks';
  }

  // Pick dots (show current round context)
  const { numTeams } = state.config;
  const currentRound = Math.ceil(state.currentPick / numTeams);
  const roundStart = (currentRound - 1) * numTeams + 1;
  const roundEnd = currentRound * numTeams;
  const myPicks = new Set(getMyPickNumbers());

  let dots = '';
  for (let i = roundStart; i <= roundEnd; i++) {
    let cls = 'pick-dot';
    if (i < state.currentPick) cls += ' done';
    if (i === state.currentPick) cls += ' current';
    if (myPicks.has(i)) cls += ' mine';
    if (myPicks.has(i) && i < state.currentPick) cls += ' done';
    dots += `<div class="${cls}" title="Pick ${i} (Team ${getPickTeam(i)})"></div>`;
  }
  document.getElementById('pick-dots').innerHTML = dots;
}

function renderAlerts() {
  const alerts = getAlerts();
  const container = document.getElementById('alerts');
  if (alerts.length === 0) {
    container.innerHTML = '';
    return;
  }
  container.innerHTML = alerts.map(a =>
    `<div class="alert alert-${a.type}">${a.text}</div>`
  ).join('');
}

function renderRecs() {
  const recs = getRecommendations();
  const myTurn = isMyPick(state.currentPick);
  const filtered = recs.filter(p => !(p.rk && p.rk.some(r => r.s === 'out')));
  const top = filtered.slice(0, 10);
  const container = document.getElementById('recs-list');
  let lateMode = '';
  if (state.lateDraftMode) {
    lateMode = '<div class="badge-late-mode">Late-Draft Mode Active — scoring simplified for best remaining value</div>';
  }

  container.innerHTML = lateMode + top.map((p, i) => {
    const tierLabel = getTierLabel(p.tier);
    const tierClass = p.tier <= 1 ? 'badge-tier-1' : p.tier <= 2 ? 'badge-tier-2' : 'badge-tier-3';

    let badges = `<span class="badge ${tierClass}">${tierLabel}</span>`;
    // Hugo risk badge (expert assessment) — replaces our games-played guess
    if (p.hr) {
      const riskClass = p.hr === 'Very Low' ? 'hugo-risk-vlow' : p.hr === 'Low' ? 'hugo-risk-low' : p.hr === 'Medium' ? 'hugo-risk-med' : 'hugo-risk-high';
      badges += `<span class="badge ${riskClass}">${p.hr} Risk</span>`;
    }
    if (p.positions.length > 1) badges += `<span class="badge badge-dual">DUAL POS</span>`;
    if (p.consistency > 0.7) badges += `<span class="badge badge-consistent">CONSISTENT</span>`;
    if (p.isFragile) badges += `<span class="badge badge-fragile">FRAGILE (${p.g}gm)</span>`;
    if (p.cliffBonus > 0) badges += `<span class="badge badge-scarce">TIER CLIFF +${p.cliffBonus.toFixed(0)}</span>`;
    if (p.trendData.spread > 25 && p.trendData.seasons.length >= 2) badges += `<span class="badge badge-volatile">VOLATILE</span>`;
    if (p.isBlended) badges += `<span class="badge badge-blended">BLENDED ${p.blendedAvg.toFixed(1)}</span>`;

    // Injury badges (2026 preseason)
    if (p.injInfo) {
      const ij = p.injInfo;
      if (ij.s === 'season') {
        badges += `<span class="badge badge-inj-season">🚫 OUT FOR SEASON — ${ij.i}</span>`;
      } else if (ij.s === 'months') {
        badges += `<span class="badge badge-inj-months">🔴 OUT MONTHS — ${ij.i}</span>`;
      } else if (ij.s === 'weeks') {
        badges += `<span class="badge badge-inj-weeks">🟠 OUT WEEKS — ${ij.i}</span>`;
      } else if (ij.s === 'doubt') {
        badges += `<span class="badge badge-inj-doubt">🟡 R1 DOUBT — ${ij.i}</span>`;
      } else if (ij.s === 'managed') {
        badges += `<span class="badge badge-inj-managed">🟢 MANAGED — ${ij.i}</span>`;
      }
    }

    // Risk badges (from player data)
    if (p.rk) {
      for (const risk of p.rk) {
        if (risk.s === 'out') badges += `<span class="badge badge-out">OUT FOR SEASON</span>`;
        else if (risk.s === 'high') badges += `<span class="badge badge-injured">INJURED — ${risk.l.split('—')[1]?.trim() || risk.l}</span>`;
        else if (risk.s === 'med') badges += `<span class="badge badge-minor">MINOR — ${risk.l.split('—')[1]?.trim() || risk.l}</span>`;
        else if (risk.t === 'trade') badges += `<span class="badge badge-trade">${risk.l}</span>`;
        else if (risk.t === 'dpp') badges += `<span class="badge badge-dpp-change">${risk.l}</span>`;
      }
    }

    // Check if scarce at their position
    const available = getAvailable();
    for (const pos of p.positions) {
      const posAvail = available.filter(pp => playerHasPosition(pp, pos) && pp.a > (state.replacementLevels[pos] || 0));
      if (posAvail.length <= state.config.numTeams * 0.5) {
        badges += `<span class="badge badge-scarce">SCARCE ${pos}</span>`;
        break;
      }
    }

    const posTags = p.positions.map(pos =>
      `<span class="pos-tag pos-tag-${pos}">${pos}</span>`
    ).join(' ');

    // 3-season trend display
    let trendHtml = '';
    if (p.trendData.seasons.length >= 2) {
      const arrow = p.trendData.trend === 'up' ? '<span class="trend-up">\u2191</span>'
        : p.trendData.trend === 'down' ? '<span class="trend-down">\u2193</span>'
        : '<span class="trend-stable">\u2192</span>';
      const seasonStr = p.trendData.seasons.map(s => s.avg.toFixed(0)).join('\u2192');
      trendHtml = `<span class="rec-trend">${seasonStr} ${arrow}</span>`;
    }

    // 3-season games played + age
    const extra = PLAYER_EXTRA[p.n];
    let gamesHtml = '';
    if (extra) {
      const g23 = extra.g23 != null ? extra.g23 : '-';
      const g24 = extra.g24 != null ? extra.g24 : '-';
      gamesHtml = `<span class="rec-games">gm: ${g23}\u2192${g24}\u2192${p.g}</span>`;
    }
    const ageHtml = extra && extra.age != null ? `<span class="rec-age">${extra.age}yo</span>` : '';

    const btnClass = myTurn ? 'rec-draft-btn' : 'rec-draft-btn other';
    const btnText = myTurn ? 'Draft' : 'Taken';
    const btnAction = myTurn ? `draftPlayer('${p.n.replace(/'/g, "\\'")}', true)` : `draftPlayer('${p.n.replace(/'/g, "\\'")}', false)`;

    // Hugo draft range — show if it's a steal or a reach
    let hugoRangeHtml = '';
    if (p.hdr) {
      const rangeParts = p.hdr.replace('+', '').split('-').map(Number);
      const rangeHigh = rangeParts[rangeParts.length - 1] || rangeParts[0];
      const rangeLow = rangeParts[0];
      const currentPick = state.currentPick;
      let rangeClass = 'hugo-range';
      let rangeLabel = '';
      if (currentPick > rangeHigh + 10) {
        rangeClass += ' steal';
        rangeLabel = 'STEAL ';
      } else if (currentPick < rangeLow - 15) {
        rangeClass += ' reach';
        rangeLabel = 'REACH ';
      }
      hugoRangeHtml = `<span class="${rangeClass}">${rangeLabel}Range: ${p.hdr}</span>`;
    }

    // Hugo concern/opportunity one-liner
    let hugoNoteHtml = '';
    if (p.hc && p.ho) {
      hugoNoteHtml = `<div class="hugo-note"><span class="concern">Risk:</span> ${p.hc} <span class="opportunity">Upside:</span> ${p.ho}</div>`;
    } else if (p.hc) {
      hugoNoteHtml = `<div class="hugo-note"><span class="concern">Risk:</span> ${p.hc}</div>`;
    } else if (p.ho) {
      hugoNoteHtml = `<div class="hugo-note"><span class="opportunity">Upside:</span> ${p.ho}</div>`;
    }

    return `
      <div class="rec-card">
        <div class="rec-rank">${i + 1}</div>
        <div class="rec-info">
          <div class="rec-name">${p.n}</div>
          <div class="rec-meta">
            ${posTags}
            <span>${p.t}</span>
            ${ageHtml}
            ${gamesHtml || `<span class="rec-games">${p.g}gm</span>`}
            ${trendHtml}
            ${hugoRangeHtml}
          </div>
          <div class="rec-badges">${badges}</div>
          ${p.fragileSwap ? `<div class="fragile-swap">Durable alt: ${p.fragileSwap}</div>` : ''}
          ${p.injInfo && p.injInfo.s !== 'available' && p.injInfo.s !== 'managed' ? `<div class="inj-detail">⚕ ${p.injInfo.d}${p.injInfo.mr > 0 ? ' (~' + p.injInfo.mr + ' rounds missed)' : ''}</div>` : ''}
          ${hugoNoteHtml}
        </div>
        <div style="text-align:right; flex-shrink:0;">
          <div class="rec-avg">${p.a}</div>
          <div style="font-size:0.75rem; font-weight:700; color:var(--accent);">EV: ${p.adjustedScore.toFixed(1)}${p.isBlended ? ' <span style="color:#a78bfa;font-size:0.65rem;font-weight:400;">(blended)</span>' : ''}</div>
          <div style="font-size:0.7rem; color:var(--text2); line-height:1.4; opacity:0.6;">
            ${p.injFactor < 1 ? `<span style="color:#ff8c42">inj ×${p.injFactor.toFixed(2)}</span> ` : ''}${p.fragilePenalty > 0 ? `<span style="color:var(--red)">fragile -${p.fragilePenalty.toFixed(0)}</span> ` : ''}${p.hugoRiskPenalty > 0 ? `<span style="color:var(--red)">risk -${p.hugoRiskPenalty.toFixed(0)}</span> ` : ''}${p.trendBonus > 0 ? `<span style="color:var(--green)">trend +${p.trendBonus}</span> ` : ''}${p.trendBonus < 0 ? `<span style="color:var(--red)">trend ${p.trendBonus}</span> ` : ''}${p.cliffBonus > 0 ? `<span style="color:var(--yellow)">cliff +${p.cliffBonus.toFixed(0)}</span>` : ''}
          </div>
          <div style="font-size:0.65rem; color:var(--text2); opacity:0.5; margin-top:2px;">PSSV: ${p.pssv.toFixed(1)} | VORP: ${p.vorp.toFixed(1)}</div>
        </div>
        <div style="display:flex; flex-direction:column; gap:4px; flex-shrink:0;">
          <button class="${btnClass}" onclick="${btnAction}">${btnText}</button>
          <button class="rec-remove-btn" onclick="event.stopPropagation(); removePlayer('${p.n.replace(/'/g, "\\'")}')" title="Remove from pool">✕</button>
        </div>
      </div>
    `;
  }).join('');

  // Show removed count + restore button
  const removedBar = document.getElementById('removed-bar');
  if (removedBar) {
    if (state.removedNames.size > 0) {
      removedBar.innerHTML = `<span>${state.removedNames.size} player${state.removedNames.size > 1 ? 's' : ''} removed</span> <button onclick="undoRemoveLast()">Undo Last</button> <button onclick="undoRemoveAll()">Restore All</button>`;
      removedBar.style.display = 'flex';
    } else {
      removedBar.style.display = 'none';
    }
  }
}

function renderPlayers() {
  const search = (document.getElementById('search-input')?.value || '').toLowerCase();
  const filter = state.posFilter;

  let players = PLAYER_DATA;

  if (filter !== 'ALL') {
    players = players.filter(p => playerHasPosition(p, filter));
  }

  if (search) {
    players = players.filter(p => p.n.toLowerCase().includes(search));
  }

  // Hide already-drafted and removed players so the list always shows available ones
  players = players.filter(p => !state.draftedNames.has(p.n) && !state.removedNames.has(p.n));

  // Show max 100 players
  const shown = players.slice(0, 100);
  const levels = state.replacementLevels;

  const container = document.getElementById('player-list');
  container.innerHTML = shown.map(p => {
    const drafted = state.draftedNames.has(p.n);
    const positions = getPositions(p);
    const posTags = positions.map(pos =>
      `<span class="pos-tag pos-tag-${pos}">${pos}</span>`
    ).join(' ');

    let bestVORP = -Infinity;
    for (const pos of positions) {
      const vorp = p.a - (levels[pos] || 0);
      if (vorp > bestVORP) bestVORP = vorp;
    }
    const vorpClass = bestVORP >= 0 ? 'positive' : 'negative';

    const myTurn = isMyPick(state.currentPick);
    const action = drafted ? '' : (
      myTurn ?
        `onclick="draftPlayer('${p.n.replace(/'/g, "\\'")}', true)"` :
        `onclick="draftPlayer('${p.n.replace(/'/g, "\\'")}', false)"`
    );

    let riskBadges = '';
    // Injury badges (2026 preseason)
    const plInj = getInjuryInfo(p.n);
    if (plInj) {
      if (plInj.s === 'season') riskBadges += `<span class="badge badge-inj-season" style="font-size:0.6rem;">🚫 SEASON</span>`;
      else if (plInj.s === 'months') riskBadges += `<span class="badge badge-inj-months" style="font-size:0.6rem;">🔴 MONTHS</span>`;
      else if (plInj.s === 'weeks') riskBadges += `<span class="badge badge-inj-weeks" style="font-size:0.6rem;">🟠 WEEKS</span>`;
      else if (plInj.s === 'doubt') riskBadges += `<span class="badge badge-inj-doubt" style="font-size:0.6rem;">🟡 DOUBT</span>`;
      else if (plInj.s === 'managed') riskBadges += `<span class="badge badge-inj-managed" style="font-size:0.6rem;">🟢 MGD</span>`;
    }
    if (p.rk) {
      for (const risk of p.rk) {
        if (risk.s === 'out') riskBadges += `<span class="badge badge-out" style="font-size:0.6rem;">OUT</span>`;
        else if (risk.s === 'high') riskBadges += `<span class="badge badge-injured" style="font-size:0.6rem;">INJ</span>`;
        else if (risk.s === 'med') riskBadges += `<span class="badge badge-minor" style="font-size:0.6rem;">INJ</span>`;
        else if (risk.t === 'trade') riskBadges += `<span class="badge badge-trade" style="font-size:0.6rem;">NEW</span>`;
        else if (risk.t === 'dpp') riskBadges += `<span class="badge badge-dpp-change" style="font-size:0.6rem;">DPP</span>`;
      }
    }
    const plExtra = PLAYER_EXTRA[p.n];
    const plAge = plExtra && plExtra.age != null ? plExtra.age : '';
    let plGames = '';
    if (plExtra) {
      const g23 = plExtra.g23 != null ? plExtra.g23 : '-';
      const g24 = plExtra.g24 != null ? plExtra.g24 : '-';
      plGames = `${g23}\u2192${g24}\u2192${p.g}`;
    }
    return `
      <div class="player-row ${drafted ? 'drafted' : ''}" ${action}>
        ${posTags}
        <span class="pl-name">${p.n}${riskBadges ? ' ' + riskBadges : ''}</span>
        <span class="pl-team">${p.t}</span>
        <span class="pl-age">${plAge}</span>
        <span class="pl-games">${plGames}</span>
        <span class="pl-avg">${p.a}</span>
        <button class="pl-remove-btn" onclick="event.stopPropagation(); removePlayer('${p.n.replace(/'/g, "\\'")}')" title="Remove from pool">✕</button>
      </div>
    `;
  }).join('');

  // Position filters
  const filterContainer = document.getElementById('pos-filters');
  if (filterContainer.children.length === 0) {
    const positions = ['ALL', 'DEF', 'MID', 'RUC', 'FWD'];
    filterContainer.innerHTML = positions.map(pos =>
      `<button class="pos-filter ${state.posFilter === pos ? 'active' : ''}" onclick="setFilter('${pos}')">${pos}</button>`
    ).join('');
  }
}

function setFilter(pos) {
  state.posFilter = pos;
  document.querySelectorAll('.pos-filter').forEach(el => {
    el.classList.toggle('active', el.textContent === pos);
  });
  renderPlayers();
}

function renderMyTeam() {
  const needs = getRosterNeeds();
  const container = document.getElementById('my-team');
  let html = '';

  for (const pos of ['DEF', 'MID', 'RUC', 'FWD']) {
    const players = state.myTeam[pos];
    const starterSlots = state.config.roster[pos];

    html += `
      <div class="team-pos-group">
        <div class="team-pos-header">
          <span class="team-pos-title ${getPosClass(pos)}">${pos}</span>
          <span class="team-pos-count">
            <span class="${players.length >= starterSlots ? 'filled' : ''}">${players.length}</span>/${starterSlots}
          </span>
        </div>
    `;

    if (players.length === 0) {
      html += '<div class="team-empty">No players drafted yet</div>';
    } else {
      players.forEach((p, i) => {
        html += `
          <div class="team-player">
            <span>${p.n} <span style="color:var(--text2);font-size:0.8rem">${p.t}</span></span>
            <span class="tp-avg">${p.a}</span>
          </div>
        `;
      });
    }

    html += '</div>';
  }

  // Bench section
  const benchTotal = state.config.benchTotal;
  html += `
    <div class="team-pos-group">
      <div class="team-pos-header">
        <span class="team-pos-title" style="background:var(--bg3);color:var(--text);padding:2px 8px;border-radius:4px;font-size:0.75rem;font-weight:700;">BENCH</span>
        <span class="team-pos-count">
          <span class="${state.myBench.length >= benchTotal ? 'filled' : ''}">${state.myBench.length}</span>/${benchTotal}
          (any position)
        </span>
      </div>
  `;
  if (state.myBench.length === 0) {
    html += '<div class="team-empty">No bench players yet</div>';
  } else {
    state.myBench.forEach(p => {
      const positions = getPositions(p);
      const posTags = positions.map(pos => `<span class="pos-tag pos-tag-${pos}" style="font-size:0.6rem;padding:1px 4px;">${pos}</span>`).join(' ');
      html += `
        <div class="team-player">
          <span>${posTags} ${p.n} <span style="color:var(--text2);font-size:0.8rem">${p.t}</span></span>
          <span class="tp-avg">${p.a}</span>
        </div>
      `;
    });
  }
  html += '</div>';

  // Team summary
  const benchAvg = state.myBench.reduce((s, p) => s + p.a, 0);
  const totalAvg = Object.values(state.myTeam).flat().reduce((s, p) => s + p.a, 0) + benchAvg;
  const totalPlayers = getMyTotalPicks();
  if (totalPlayers > 0) {
    html += `
      <div class="team-pos-group" style="text-align:center;">
        <div style="font-size:0.85rem;color:var(--text2);">Team Average</div>
        <div style="font-size:1.5rem;font-weight:800;">${(totalAvg / totalPlayers).toFixed(1)}</div>
        <div style="font-size:0.8rem;color:var(--text2);">${totalPlayers} players drafted</div>
      </div>
    `;
  }

  container.innerHTML = html;
}

function renderLog() {
  const container = document.getElementById('draft-log');
  if (state.picks.length === 0) {
    container.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text2)">No picks yet</div>';
    return;
  }

  container.innerHTML = [...state.picks].reverse().map(pick => {
    if (pick.isSkipped) {
      return `
        <div class="log-entry" style="opacity:0.5;">
          <span class="log-pick">#${pick.pickNum}</span>
          <span class="log-name" style="font-style:italic;">Unknown player</span>
          <span style="font-size:0.75rem;color:var(--text2); width:35px; text-align:right;">
            T${getPickTeam(pick.pickNum)}
          </span>
        </div>
      `;
    }
    const positions = getPositions(pick.player);
    const posTags = positions.map(pos =>
      `<span class="pos-tag pos-tag-${pos}" style="font-size:0.7rem;">${pos}</span>`
    ).join(' ');

    return `
      <div class="log-entry ${pick.isMyPick ? 'my-pick' : ''}">
        <span class="log-pick">#${pick.pickNum}</span>
        ${posTags}
        <span class="log-name">${pick.player.n}</span>
        <span style="color:var(--text2);font-size:0.8rem;">${pick.player.t || ''}</span>
        <span style="font-weight:600;width:40px;text-align:right;">${pick.player.a}</span>
        <span style="font-size:0.75rem;color:${pick.isMyPick ? 'var(--green)' : 'var(--text2)'}; width:35px; text-align:right;">
          ${pick.isMyPick ? 'YOU' : 'T' + getPickTeam(pick.pickNum)}
        </span>
      </div>
    `;
  }).join('');
}

function updateTabBadges() {
  document.getElementById('team-count').textContent = getMyTotalPicks();
}

function switchTab(tab) {
  state.activeTab = tab;
  document.querySelectorAll('.tab').forEach(t => {
    t.classList.toggle('active', t.dataset.tab === tab);
  });
  document.querySelectorAll('.tab-content').forEach(tc => {
    tc.style.display = tc.id === `tab-${tab}` ? 'block' : 'none';
  });
  if (tab === 'players') {
    setTimeout(() => document.getElementById('search-input')?.focus(), 100);
  }
  if (tab === 'league') {
    setTimeout(() => renderLeagueCharts(), 50);
  }
}

/* =========================================================
   STARTUP
   ========================================================= */
function startDraft() {
  const numTeams = parseInt(document.getElementById('cfg-teams').value);
  const draftPos = parseInt(document.getElementById('cfg-pos').value);
  const rounds = parseInt(document.getElementById('cfg-rounds').value);

  if (draftPos > numTeams) {
    alert('Draft position cannot be greater than number of teams!');
    return;
  }

  state.config = {
    numTeams,
    draftPos,
    rounds,
    roster: {
      DEF: parseInt(document.getElementById('cfg-def').value),
      MID: parseInt(document.getElementById('cfg-mid').value),
      RUC: parseInt(document.getElementById('cfg-ruc').value),
      FWD: parseInt(document.getElementById('cfg-fwd').value),
    },
    benchTotal: parseInt(document.getElementById('cfg-bench').value),
  };

  // Validate rounds match roster
  const totalSlots = Object.values(state.config.roster).reduce((s, v) => s + v, 0)
    + state.config.benchTotal;

  if (state.config.rounds !== totalSlots) {
    const proceed = confirm(
      `Rounds (${state.config.rounds}) doesn't match total roster slots (${totalSlots}).\n\n` +
      `Click OK to auto-set rounds to ${totalSlots}, or Cancel to keep ${state.config.rounds}.`
    );
    if (proceed) {
      state.config.rounds = totalSlots;
      document.getElementById('cfg-rounds').value = totalSlots;
    }
  }

  document.getElementById('config-screen').style.display = 'none';
  document.getElementById('draft-screen').style.display = 'block';

  // Initial calculations
  calculateReplacementLevels(PLAYER_DATA);
  state.qualityThresholds = { ...state.replacementLevels };
  calculateTiers(PLAYER_DATA);
  render();

  // Auto-switch to recs or players based on pick
  if (isMyPick(1)) {
    switchTab('recs');
  } else {
    switchTab('recs');
  }
}

// Check player data loaded
if (typeof PLAYER_DATA === 'undefined' || !PLAYER_DATA.length) {
  document.body.innerHTML = `
    <div style="max-width:500px;margin:100px auto;text-align:center;padding:20px;">
      <h2 style="color:#ff4a6a;">Player Data Not Found</h2>
      <p style="color:#999;margin-top:12px;">
        Make sure <code>players_data.js</code> is in the same folder as this HTML file.
      </p>
      <p style="color:#999;margin-top:8px;">
        If opening from your file system doesn't work, run a local server:<br>
        <code style="background:#1a1a2e;padding:4px 8px;border-radius:4px;">python3 -m http.server 8000</code><br>
        then open <code>http://localhost:8000/draft_assistant_2026-02-17.html</code>
      </p>
    </div>
  `;
}

// Keyboard shortcut: Escape to close modal
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeModal();
});

// Redraw charts on window resize
let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    if (state.activeTab === 'league') renderLeagueCharts();
  }, 200);
});
</script>
</body>
</html>
